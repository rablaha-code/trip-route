<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 도쿄 콜라보 이벤트 지도 (통합)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .leaflet-popup-content-wrapper { border-radius: 12px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .leaflet-popup-content { margin: 16px; font-family: sans-serif; min-width: 250px; }
        .custom-marker { transition: transform 0.2s; }
        .custom-marker:hover { transform: scale(1.1); }
        
        /* Resizing Cursor */
        body.resizing { cursor: col-resize; user-select: none; }
        body.resizing iframe { pointer-events: none; } 

        /* Map Label (Tooltip) Style */
        .map-label {
            background-color: rgba(255, 255, 255, 0.9) !important;
            border: 1px solid #e2e8f0 !important;
            border-radius: 6px !important;
            padding: 2px 8px !important;
            font-size: 11px !important;
            font-weight: 700 !important;
            color: #374151 !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            white-space: nowrap;
            opacity: 1 !important; 
            transition: opacity 0.2s ease-in-out;
        }
        /* Hide tooltip arrow */
        .leaflet-tooltip-left:before, .leaflet-tooltip-right:before, .leaflet-tooltip-bottom:before, .leaflet-tooltip-top:before {
            border: none !important;
            display: none !important;
        }

        /* Label visibility toggle */
        .hide-labels .leaflet-tooltip {
            opacity: 0 !important;
            visibility: hidden !important;
        }
    </style>
</head>
<body class="bg-gray-50 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-indigo-600 text-white p-4 shadow-md z-10 flex justify-between items-center shrink-0">
        <div class="flex items-center gap-2">
            <i data-lucide="map" class="w-6 h-6"></i>
            <h1 class="text-lg font-bold truncate">2026 도쿄 콜라보 맵</h1>
        </div>
        <div class="flex items-center gap-3">
            <!-- Label Toggle Switch -->
            <label class="flex items-center cursor-pointer bg-indigo-700/50 hover:bg-indigo-700 px-3 py-1.5 rounded-full transition-colors select-none border border-indigo-500/30">
                <div class="relative">
                    <input type="checkbox" id="label-toggle" class="sr-only peer" checked>
                    <div class="w-7 h-4 bg-indigo-900/50 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-indigo-400"></div>
                </div>
                <span class="ms-2 text-xs font-medium text-white whitespace-nowrap">라벨 ON</span>
            </label>

            <span class="text-xs bg-indigo-500 px-2 py-1 rounded text-indigo-100 hidden sm:flex items-center gap-1">
                <i data-lucide="info" class="w-3 h-3"></i> 운영시간 포함
            </span>
        </div>
    </header>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col md:flex-row overflow-hidden relative">
        
        <!-- Sidebar List -->
        <div id="sidebar" style="width: 384px;" class="w-full md:w-auto bg-white border-r border-gray-200 overflow-y-auto shrink-0 z-20 order-2 md:order-1 h-[40%] md:h-full shadow-inner md:shadow-none flex flex-col">
            <div class="p-4 border-b border-gray-100 bg-gray-50 sticky top-0 z-10 backdrop-blur-sm bg-white/90 shrink-0">
                <h2 class="font-semibold text-gray-700 flex items-center gap-2 text-sm uppercase tracking-wider">
                    <i data-lucide="list" class="w-4 h-4"></i> 이벤트 목록
                </h2>
            </div>
            <ul id="event-list" class="divide-y divide-gray-100 pb-20 md:pb-0 flex-1">
                <!-- List items will be injected here -->
            </ul>
        </div>

        <!-- Resizer Handle (Desktop Only) -->
        <div id="resizer" class="hidden md:block w-1.5 bg-gray-100 hover:bg-indigo-400 cursor-col-resize z-30 order-1 md:order-1 transition-colors duration-200 border-l border-r border-gray-200 shrink-0 relative flex items-center justify-center group">
            <div class="w-0.5 h-8 bg-gray-300 rounded group-hover:bg-white transition-colors"></div>
        </div>

        <!-- Map Container -->
        <div id="map" class="flex-1 z-0 order-1 md:order-2 h-[60%] md:h-full w-full bg-gray-100 min-w-0 transition-opacity duration-300"></div>

    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        // --- UI Control Logic ---
        const labelToggle = document.getElementById('label-toggle');
        const mapElement = document.getElementById('map');
        const toggleText = labelToggle.parentElement.querySelector('span');

        labelToggle.addEventListener('change', (e) => {
            if (e.target.checked) {
                mapElement.classList.remove('hide-labels');
                toggleText.textContent = '라벨 ON';
                toggleText.classList.remove('opacity-50');
            } else {
                mapElement.classList.add('hide-labels');
                toggleText.textContent = '라벨 OFF';
                toggleText.classList.add('opacity-50');
            }
        });

        // --- Resizing Logic ---
        const resizer = document.getElementById('resizer');
        const sidebar = document.getElementById('sidebar');
        const mapContainer = document.getElementById('map');
        const body = document.body;

        if (resizer) {
            resizer.addEventListener('mousedown', initResize);
        }

        function initResize(e) {
            e.preventDefault();
            body.classList.add('resizing');
            window.addEventListener('mousemove', resize);
            window.addEventListener('mouseup', stopResize);
        }

        function resize(e) {
            const newWidth = Math.max(250, Math.min(e.clientX, 600));
            sidebar.style.width = newWidth + 'px';
            if (map) map.invalidateSize();
        }

        function stopResize() {
            body.classList.remove('resizing');
            window.removeEventListener('mousemove', resize);
            window.removeEventListener('mouseup', stopResize);
        }

        // --- Map Data & Logic ---

        // Define Color Map centrally
        const colorMap = {
            red: '#ef4444',
            orange: '#f97316',
            blue: '#3b82f6',
            purple: '#a855f7',
            yellow: '#eab308',
            pink: '#ec4899',   // 마법소녀
            cyan: '#06b6d4',   // 호시마치 스이세이
            rose: '#f43f5e',   // 100명의 여친
            green: '#22c55e',  // 니케 (통합 색상)
            sky: '#0ea5e9'     // 블루 아카이브
        };

        const events = [
            {
                id: 1,
                title: "걸즈 밴드 크라이 Y2K 스토어",
                date: "1.23(금) ~ 2.1(일)",
                location: "신주쿠 마루이 멘 8F",
                area: "신주쿠",
                hours: "11:00 - 20:00",
                desc: "Y2K 패션 굿즈 & 포스트카드 특전",
                lat: 35.69165,
                lng: 139.70464,
                color: "red",
                url: "https://collabo-cafe.com/events/collabo/girls-band-cry-pop-up-store-amnibus-shinjuku2026/",
                tooltipConfig: { direction: 'right', offset: [12, 0] }
            },
            {
                id: 2,
                title: "데이트 어 라이브 V 팝업",
                date: "1.16(금) ~ 2.1(일)",
                location: "보크스 아키하바라 하비천국2 1F",
                area: "아키하바라",
                hours: "평일 11:00-20:00 / 주말 10:00-20:00",
                desc: "이상한 나라의 앨리스 테마 의상 굿즈",
                lat: 35.70014,
                lng: 139.77148,
                color: "orange",
                url: "https://collabo-cafe.com/events/collabo/date-a-live-alice-pop-up-store-volks-akihabara2026/",
                tooltipConfig: { direction: 'top', offset: [0, -10] }
            },
            {
                id: 3,
                title: "마법소녀를 동경해서 GAL ver.",
                date: "1.17(토) ~ 2.1(일)",
                location: "게이머즈 아키하바라 본점",
                area: "아키하바라",
                hours: "11:00 - 21:00",
                desc: "GAL(갸루) 컨셉 굿즈 & 브로마이드 증정",
                lat: 35.69793,
                lng: 139.77169,
                color: "pink",
                url: "https://collabo-cafe.com/events/collabo/mahoako-pop-up-store-gamers-2026/",
                tooltipConfig: { direction: 'right', offset: [12, 0] }
            },
            {
                id: 4,
                title: "Fate/strange Fake 스토어",
                date: "1.15(목) ~ 1.26(월)",
                location: "유라쿠초 마루이 8F",
                area: "유라쿠초",
                hours: "11:00 - 20:00",
                desc: "방송 개시 기념 PALE TONE 굿즈 판매",
                lat: 35.67493,
                lng: 139.76343,
                color: "blue",
                url: "https://collabo-cafe.com/events/collabo/fate-pop-up-store-the-chara-yurakucho-marui-2026/",
                tooltipConfig: { direction: 'right', offset: [12, 0] }
            },
            {
                id: 5,
                title: "철야의 노래 스트리트 패션",
                date: "1.16(금) ~ 2.1(일)",
                location: "MAGNET by SHIBUYA109 5F",
                area: "시부야",
                hours: "10:00 - 21:00",
                desc: "스트리트 패션 나즈나 굿즈 (AMNIBUS)",
                lat: 35.65961,
                lng: 139.70043,
                color: "purple",
                url: "https://collabo-cafe.com/events/collabo/yofukashi-pop-up-store-street-fashion-amnibus2026/",
                tooltipConfig: { direction: 'top', offset: [0, -12] }
            },
            {
                id: 6,
                title: "호시마치 스이세이 × 빅에코",
                date: "1.10(토) ~ 2.28(토)",
                location: "빅에코 아키하바라 전기상점가구치",
                area: "아키하바라",
                hours: "10:00 - 05:00 (익일)",
                desc: "콜라보 룸 및 한정 드링크/코스터",
                lat: 35.69862,
                lng: 139.77313,
                color: "cyan",
                url: "https://collabo-cafe.com/events/collabo/hoshimachi-suisei-bigecho-campaign-2026/",
                tooltipConfig: { direction: 'bottom', offset: [0, 10] }
            },
            {
                id: 7,
                title: "명일방주: 엔드필드 팝업",
                date: "1.24(토) ~ 2.8(일)",
                location: "애니메이트 이케부쿠로 본점",
                area: "이케부쿠로",
                hours: "평일 11:00-21:00 / 주말 10:00-20:00",
                desc: "글로벌 투어 팝업 & 등신대 전시",
                lat: 35.73142,
                lng: 139.71552,
                color: "yellow",
                url: "https://www.animate.co.jp/shop/ikebukuro/",
                tooltipConfig: { direction: 'right', offset: [12, 0] }
            },
            {
                id: 8,
                title: "100명의 여친 아시안 메이드",
                date: "1.31(토) ~ 2.15(일)",
                location: "MEDICOS SHOP 시부야 (MAGNET 5F)",
                area: "시부야",
                hours: "10:00 - 21:00",
                desc: "아시안 메이드 풍 신규 굿즈 & 특전",
                lat: 35.65961 + 0.00015,
                lng: 139.70043 + 0.00015,
                color: "rose",
                url: "https://collabo-cafe.com/events/collabo/100-kano-pop-up-store-medicos-tokyo-osaka2026/",
                tooltipConfig: { direction: 'bottom', offset: [0, 12] }
            },
            // --- [New] NIKKE x Gratte (All Green) ---
            {
                id: 9,
                title: "니케 x Gratte (이케부쿠로)",
                date: "~ 2.8(일)까지",
                location: "애니메이트 이케부쿠로 본점",
                area: "이케부쿠로",
                hours: "평일 11:00-21:00 / 주말 10:00-20:00",
                desc: "그래픽 라떼 & 쿠키, 코스터 증정",
                lat: 35.73142,
                lng: 139.71552,
                color: "green",
                url: "https://www.animate.co.jp/gratte/34369/",
                tooltipConfig: { direction: 'bottom', offset: [0, 10] }
            },
            {
                id: 10,
                title: "니케 x Gratte (아키하바라)",
                date: "~ 2.8(일)까지",
                location: "애니메이트 아키하바라 ANNEX",
                area: "아키하바라",
                hours: "11:00 - 21:00",
                desc: "그래픽 라떼 & 쿠키, 코스터 증정",
                lat: 35.70050, 
                lng: 139.77050,
                color: "green",
                url: "https://www.animate.co.jp/gratte/34369/",
                tooltipConfig: { direction: 'left', offset: [-12, 0] }
            },
            {
                id: 11,
                title: "니케 x Gratte (시부야)",
                date: "~ 2.8(일)까지",
                location: "애니메이트 시부야 (BEAM 3F)",
                area: "시부야",
                hours: "11:00 - 21:00",
                desc: "그래픽 라떼 & 쿠키, 코스터 증정",
                lat: 35.66050, 
                lng: 139.69850,
                color: "green",
                url: "https://www.animate.co.jp/gratte/34369/",
                tooltipConfig: { direction: 'right', offset: [12, 0] }
            },
            // --- [New] Blue Archive in atre ---
            {
                id: 12,
                title: "블루 아카이브 in 아트레",
                date: "2.1(일) ~ 2.14(토)",
                location: "아트레 아키하바라 1 (2F)",
                area: "아키하바라",
                hours: "10:00 - 21:00 (마지막날 ~20:00)",
                desc: "팝업 스토어 & 2,200엔 구매 특전",
                lat: 35.69835, 
                lng: 139.77325,
                color: "sky",
                url: "https://www.movic.jp/shop/pages/bluearchive_atre2026.aspx",
                tooltipConfig: { direction: 'left', offset: [-12, 0] }
            }
        ];

        // Initialize Icons & Map
        lucide.createIcons();
        const map = L.map('map').setView([35.695, 139.74], 12);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        map.on('popupopen', () => { lucide.createIcons(); });

        const createCustomIcon = (color) => {
            const hex = colorMap[color] || '#3b82f6';
            return L.divIcon({
                className: 'custom-div-icon',
                html: `<div class="custom-marker" style="background-color: ${hex}; width: 24px; height: 24px; border-radius: 50%; border: 3px solid white; box-shadow: 0 4px 6px rgba(0,0,0,0.3);"></div>`,
                iconSize: [24, 24],
                iconAnchor: [12, 12],
                popupAnchor: [0, -12]
            });
        };

        const listContainer = document.getElementById('event-list');

        events.forEach(event => {
            const marker = L.marker([event.lat, event.lng], {
                icon: createCustomIcon(event.color)
            }).addTo(map);

            const tooltipConfig = event.tooltipConfig || { direction: 'right', offset: [12, 0] };
            marker.bindTooltip(event.title, {
                permanent: true,
                direction: tooltipConfig.direction,
                className: 'map-label',
                offset: tooltipConfig.offset
            });

            const googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(event.location)}`;

            const popupContent = `
                <div class="min-w-[220px]">
                    <div class="text-xs font-bold text-gray-500 mb-1 tracking-wide flex items-center gap-1">
                        <i data-lucide="map-pin" class="w-3 h-3"></i> ${event.area}
                    </div>
                    <h3 class="font-bold text-base text-gray-900 mb-2 leading-tight">${event.title}</h3>
                    <div class="space-y-1 mb-3">
                        <div class="text-xs text-gray-600 flex items-start gap-1">
                            <span class="font-semibold shrink-0">장소:</span>
                            <span>${event.location}</span>
                        </div>
                        <div class="text-xs text-gray-600 flex items-start gap-1">
                            <span class="font-semibold shrink-0">시간:</span>
                            <span>${event.hours}</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-xs text-indigo-600 font-medium bg-indigo-50 px-2 py-1 rounded border border-indigo-100 flex items-center gap-1">
                            <i data-lucide="calendar" class="w-3 h-3"></i> ${event.date}
                        </span>
                    </div>
                    
                    <!-- [UPDATED] Two Buttons Layout -->
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="window.open('${event.url}', '_blank')" class="bg-white border border-indigo-500 hover:bg-indigo-50 text-indigo-600 text-xs font-bold py-2.5 rounded shadow-sm transition-colors flex items-center justify-center gap-1.5 cursor-pointer">
                            <span>이벤트 보기</span>
                            <i data-lucide="external-link" class="w-3 h-3"></i>
                        </button>
                        <button onclick="window.open('${googleMapsUrl}', '_blank')" class="bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-bold py-2.5 rounded shadow-sm transition-colors flex items-center justify-center gap-1.5 cursor-pointer">
                            <span>구글 맵</span>
                            <i data-lucide="map" class="w-3 h-3"></i>
                        </button>
                    </div>
                </div>
            `;

            marker.bindPopup(popupContent);

            const hexColor = colorMap[event.color] || '#3b82f6';
            const listItem = document.createElement('li');
            listItem.className = "cursor-pointer hover:bg-gray-50 transition-colors p-4 group border-l-4 border-transparent hover:border-indigo-500";
            listItem.innerHTML = `
                <div class="flex items-start gap-3">
                    <div class="shrink-0 mt-1 w-3 h-3 rounded-full shadow-sm" style="background-color: ${hexColor}"></div>
                    <div class="flex-1">
                        <div class="flex justify-between items-start mb-1">
                            <h3 class="font-bold text-gray-800 text-sm group-hover:text-indigo-600 transition-colors">${event.title}</h3>
                            <span class="text-[10px] font-medium px-1.5 py-0.5 rounded bg-gray-100 text-gray-500 whitespace-nowrap ml-2 border border-gray-200">${event.area}</span>
                        </div>
                        <div class="space-y-1">
                            <p class="text-xs text-gray-500 flex items-center gap-1.5">
                                <i data-lucide="clock" class="w-3 h-3 text-gray-400"></i> ${event.hours}
                            </p>
                            <p class="text-xs text-indigo-600 font-medium flex items-center gap-1.5">
                                <i data-lucide="calendar" class="w-3 h-3"></i> ${event.date}
                            </p>
                            <p class="text-xs text-gray-400 flex items-center gap-1.5 pt-1">
                                <i data-lucide="info" class="w-3 h-3 text-gray-300"></i> ${event.desc}
                            </p>
                        </div>
                    </div>
                </div>
            `;

            listItem.addEventListener('click', () => {
                map.flyTo([event.lat, event.lng], 16, { duration: 1.5 });
                marker.openPopup();
                if (window.innerWidth < 768) {
                    document.getElementById('map').scrollIntoView({ behavior: 'smooth' });
                }
            });

            listContainer.appendChild(listItem);
        });

        lucide.createIcons();

        window.addEventListener('resize', () => {
            if (window.innerWidth < 768) {
                sidebar.style.width = '100%';
            } else {
                if (sidebar.style.width === '100%') sidebar.style.width = '384px';
            }
            map.invalidateSize();
        });
    </script>
</body>
</html>


