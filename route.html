<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¼ë³¸ ì—¬í–‰ ì¼ì •</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
        }

        #map {
            height: 100%;
            width: 100%;
            z-index: 0;
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        /* Marker Animations */
        .pulse-icon {
            background-color: #ef4444;
            border-radius: 50%;
            width: 12px;
            height: 12px;
            box-shadow: 0 0 0 rgba(239, 68, 68, 0.4);
            animation: pulse 2s infinite;
        }

        .pulse-icon-blue {
            background-color: #3b82f6;
            border-radius: 50%;
            width: 12px;
            height: 12px;
            box-shadow: 0 0 0 rgba(59, 130, 246, 0.4);
            animation: pulse-blue 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }

        .schedule-item {
            transition: all 0.2s;
            border-left: 3px solid transparent;
            user-select: none;
        }

        .schedule-item:hover {
            transform: translateX(4px);
            border-left-color: #cbd5e1;
        }

        /* Active & Selected States */
        .active-card {
            border-left-color: #3b82f6 !important;
            background-color: #eff6ff !important;
        }

        .multi-selected {
            background-color: #dbeafe !important;
            border-left-color: #2563eb !important;
            border: 1px solid #93c5fd !important;
        }

        .split-badge-a {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .split-badge-b {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }

        .split-badge-shop {
            background: #f3e8ff;
            color: #6b21a8;
            border: 1px solid #e9d5ff;
        }

        /* Custom Popup */
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            padding: 0;
            overflow: hidden;
        }

        .leaflet-popup-content {
            margin: 0;
            width: 280px !important;
        }

        /* Collapse Animation */
        #info-content {
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out, padding 0.3s;
            overflow: hidden;
        }

        .collapsed-content {
            max-height: 0 !important;
            opacity: 0 !important;
            padding-top: 0 !important;
            padding-bottom: 0 !important;
        }

        .rotate-180 {
            transform: rotate(180deg);
        }

        /* Numbered Marker for Route */
        .number-icon {
            background: #2563eb;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            font-weight: bold;
            font-size: 14px;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        /* Team Toggle Switch */
        .team-toggle {
            transition: all 0.3s ease;
        }

        .team-active {
            background-color: #4f46e5;
            color: white;
            border-color: #4f46e5;
        }

        .team-inactive {
            background-color: white;
            color: #6b7280;
            border-color: #d1d5db;
        }

        /* --- [NEW] Resizer Styles --- */
        #resizer {
            background-color: #cbd5e1;
            z-index: 50;
            transition: background-color 0.2s;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #resizer:hover {
            background-color: #94a3b8;
        }

        /* Mobile: Horizontal Bar */
        @media (max-width: 768px) {
            #resizer {
                width: 100%;
                height: 12px;
                cursor: row-resize;
                border-top: 1px solid #e2e8f0;
                border-bottom: 1px solid #e2e8f0;
            }

            #resizer i {
                transform: rotate(0deg);
            }
        }

        /* Desktop: Vertical Bar */
        @media (min-width: 768px) {
            #resizer {
                width: 12px;
                height: 100%;
                cursor: col-resize;
                border-left: 1px solid #e2e8f0;
                border-right: 1px solid #e2e8f0;
            }

            #resizer i {
                transform: rotate(90deg);
            }
        }
    </style>
</head>

<body class="bg-slate-100 h-screen flex flex-col md:flex-row overflow-hidden">

    <div class="md:hidden bg-indigo-600 text-white p-3 shadow-md z-20 flex justify-between items-center shrink-0">
        <h1 class="font-bold text-lg">ğŸ‡¯ğŸ‡µ 7ë°• 8ì¼ ì¼ì •í‘œ</h1>
        <span id="total-cost-mobile" class="text-xs bg-indigo-700 px-2 py-1 rounded font-mono"></span>
    </div>

    <div id="sidebar-panel"
        class="w-full md:w-[35%] h-[50%] md:h-full flex flex-col bg-white shadow-xl z-10 relative min-w-[200px] min-h-[150px]">
        <div class="hidden md:block p-5 bg-indigo-600 text-white shadow-md shrink-0">
            <h1 class="text-2xl font-bold">ğŸ‡¯ğŸ‡µ Japan Travel</h1>
            <p class="text-indigo-100 text-sm mt-1">ì˜¤ì‚¬ì¹´ â€¢ êµí†  â€¢ ë„ì¿„</p>
            <div class="mt-3 flex justify-between items-center">
                <div id="total-cost-desktop"
                    class="bg-indigo-800 px-3 py-1 rounded-full text-xs font-mono font-bold tracking-wide"></div>
                <button onclick="clearSelection()" id="btn-reset-select"
                    class="hidden text-xs bg-white text-indigo-600 px-2 py-1 rounded font-bold hover:bg-gray-100">ì„ íƒ
                    ì´ˆê¸°í™”</button>
            </div>
        </div>

        <div class="flex overflow-x-auto bg-white border-b shrink-0 scrollbar-hide whitespace-nowrap">
            <button onclick="selectDay(0)" id="tab-0"
                class="flex-shrink-0 flex-1 min-w-[70px] py-3 text-center border-b-2 text-sm font-semibold text-gray-500 hover:text-indigo-600">1ì¼ì°¨<br><span
                    class="text-xs font-normal">ì˜¤ì‚¬ì¹´</span></button>
            <button onclick="selectDay(1)" id="tab-1"
                class="flex-shrink-0 flex-1 min-w-[70px] py-3 text-center border-b-2 text-sm font-semibold text-gray-500 hover:text-indigo-600">2ì¼ì°¨<br><span
                    class="text-xs font-normal">USJ</span></button>
            <button onclick="selectDay(2)" id="tab-2"
                class="flex-shrink-0 flex-1 min-w-[70px] py-3 text-center border-b-2 text-sm font-semibold text-gray-500 hover:text-indigo-600">3ì¼ì°¨<br><span
                    class="text-xs font-normal">êµí† </span></button>
            <button onclick="selectDay(3)" id="tab-3"
                class="flex-shrink-0 flex-1 min-w-[70px] py-3 text-center border-b-2 text-sm font-semibold text-gray-500 hover:text-indigo-600">4ì¼ì°¨<br><span
                    class="text-xs font-normal">ë„ì¿„</span></button>
            <button onclick="selectDay(4)" id="tab-4"
                class="flex-shrink-0 flex-1 min-w-[70px] py-3 text-center border-b-2 text-sm font-semibold text-gray-500 hover:text-indigo-600">5ì¼ì°¨<br><span
                    class="text-xs font-normal">ììœ </span></button>
            <button onclick="selectDay(5)" id="tab-5"
                class="flex-shrink-0 flex-1 min-w-[70px] py-3 text-center border-b-2 text-sm font-semibold text-gray-500 hover:text-indigo-600">6ì¼ì°¨<br><span
                    class="text-xs font-normal">íŒ€ ë¶„ë¦¬</span></button>
            <button onclick="selectDay(6)" id="tab-6"
                class="flex-shrink-0 flex-1 min-w-[70px] py-3 text-center border-b-2 text-sm font-semibold text-gray-500 hover:text-indigo-600">7ì¼ì°¨<br><span
                    class="text-xs font-normal">ë‚˜ì¹´ë…¸</span></button>
            <button onclick="selectDay(7)" id="tab-7"
                class="flex-shrink-0 flex-1 min-w-[70px] py-3 text-center border-b-2 text-sm font-semibold text-gray-500 hover:text-indigo-600">8ì¼ì°¨<br><span
                    class="text-xs font-normal">ê·€êµ­</span></button>
        </div>

        <div id="team-selector" class="hidden p-2 bg-slate-50 border-b flex justify-center gap-2 shrink-0">
            <button onclick="selectTeam('attraction')" id="btn-team-attraction"
                class="team-toggle team-active px-4 py-1.5 rounded-full text-xs font-bold border shadow-sm">
                ğŸ¢ ì–´íŠ¸ë™ì…˜ íŒŸ (5ëª…)
            </button>
            <button onclick="selectTeam('shopping')" id="btn-team-shopping"
                class="team-toggle team-inactive px-4 py-1.5 rounded-full text-xs font-bold border shadow-sm">
                ğŸ›ï¸ ì‡¼í•‘ íŒŸ (3ëª…)
            </button>
        </div>

        <div id="schedule-list" class="flex-1 overflow-y-auto p-2 md:p-4 space-y-3 bg-slate-50 pb-20 md:pb-5"></div>

        <div id="multi-select-hint"
            class="absolute bottom-2 left-0 w-full text-center pointer-events-none transition-opacity duration-500 opacity-100">
            <span class="bg-gray-800 text-white text-xs px-3 py-1.5 rounded-full shadow-lg opacity-80">ğŸ’¡ ê¸¸ê²Œ ëˆŒëŸ¬ ì—¬ëŸ¬ ê°œ ì„ íƒ
                ê°€ëŠ¥</span>
        </div>

        <div id="split-legend"
            class="absolute bottom-0 w-full bg-white border-t p-2 text-xs flex justify-around hidden shadow-[0_-5px_15px_rgba(0,0,0,0.1)]">
        </div>
    </div>

    <div id="resizer">
        <i class="fas fa-grip-lines text-gray-500 text-xs"></i>
    </div>

    <div id="map-container" class="flex-1 w-full h-[50%] md:h-full relative min-w-[100px] min-h-[100px]">
        <div id="map"></div>

        <div id="map-info"
            class="absolute top-5 right-5 bg-white rounded-xl shadow-2xl hidden md:flex flex-col z-[400] w-80 border border-gray-100 transition-all duration-300 opacity-0 translate-y-[-20px]">
            <div class="flex justify-between items-center p-4 bg-gray-50 border-b cursor-pointer rounded-t-xl"
                onclick="toggleInfo()">
                <h3 id="info-title" class="font-bold text-gray-800 truncate pr-2"></h3>
                <div class="flex gap-3 text-gray-400">
                    <button id="toggle-icon" class="hover:text-blue-500 transition-transform duration-300"><i
                            class="fas fa-chevron-up"></i></button>
                    <button onclick="event.stopPropagation(); closeInfo()"
                        class="hover:text-red-500 transition-colors"><i class="fas fa-times"></i></button>
                </div>
            </div>
            <div id="info-content"
                class="text-sm text-gray-600 space-y-2 max-h-[60vh] overflow-y-auto p-4 bg-white rounded-b-xl collapsed-content">
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // --- 1. DATA: Locations & Detailed POIs ---
        const LOC = {
            kix: [34.4325, 135.2304],
            nambaStn: [34.6618, 135.5021],
            osakaHotel: [34.6635, 135.4975],
            tendonMakino: [34.6682, 135.5036],
            dendenTown: [34.6593, 135.5057],
            glicoMan: [34.6687, 135.5013],
            kuromon: [34.6654, 135.5074],
            aburiya: [34.6690, 135.5015],
            dotonbori: [34.6687, 135.5013],
            sumibi: [34.6675, 135.5000],
            usj: [34.6654, 135.4323],
            fukutaro: [34.6657, 135.5042],
            atthe21: [34.6668, 135.5038],
            fushimiInari: [34.9671, 135.7726],
            yamamoto: [35.0157, 135.7825],
            kiyomizu: [34.9948, 135.7850],
            sannenzaka: [34.9960, 135.7820],
            kamoRiver: [35.0080, 135.7710],
            hideatora: [35.0050, 135.7700],
            pontocho: [35.0062, 135.7716],
            gion: [35.0035, 135.7750],
            yasohachi: [35.0055, 135.7710],
            bingo: [35.0035, 135.7705],
            nishiki: [35.0050, 135.7630],
            roundOne: [34.6653, 135.5039],
            shinOsaka: [34.7334, 135.5003],
            tokyoStn: [35.6812, 139.7671],
            uenoHotel: [35.7225, 139.7828],
            kappabashi: [35.7153, 139.7895],
            sensoji: [35.7147, 139.7966],
            akihabara: [35.6983, 139.7730],
            ameyoko: [35.7088, 139.7741],
            honda: [35.6997, 139.7754],
            hotate: [35.6963, 139.7856],
            gigo: [35.6994, 139.7712],
            iriyaStn: [35.7210, 139.7845],
            kamiyachoStn: [35.6627, 139.7451],
            zojoji: [35.6574, 139.7482],
            azabudai: [35.6605, 139.7410],
            odaibaStn: [35.6293, 139.7766],
            decks: [35.6295, 139.7750],
            diverCity: [35.6252, 139.7756],
            immersive: [35.6245, 139.7800],
            tokyoTeleport: [35.6264, 139.7797],
            shinjukuStn: [35.6909, 139.7005],
            motomura: [35.6925, 139.7020],
            mysteryCircus: [35.6945, 139.7015],
            kabukicho: [35.6950, 139.7030],
            uguisudani: [35.7215, 139.7780],
            shibuyaStn: [35.6580, 139.7016],
            parco: [35.6620, 139.6987],
            miyashita: [35.6615, 139.7020],
            shibuyaSky: [35.6585, 139.7023],
            omotesando: [35.6652, 139.7123],
            harajuku: [35.6702, 139.7026],
            // [NEW] Day 7 Locations
            nakanoStn: [35.7058, 139.6658],
            nakanoBroadway: [35.7089, 139.6657],
            radioKaikan: [35.6980, 139.7720],
            traderHQ: [35.7010, 139.7718],
            melonbooks: [35.6990, 139.7715],
            gogoCurry: [35.6985, 139.7745],
            sanbo: [35.7005, 139.7710],
            surugayaDeep: [35.6990, 139.7715],
            akibaLocker: [35.6984, 139.7731],
            // [NEW] Day 6 Suburbs Locations
            kamakuraStn: [35.3190, 139.5501],
            tsurugaoka: [35.3260, 139.5564],
            komachi: [35.3228, 139.5528],
            akimoto: [35.3220, 139.5520],
            haseStn: [35.3113, 139.5361],
            daibutsu: [35.3167, 139.5357],
            kamakurakoko: [35.3067, 139.5015],
            enoshimaIsland: [35.3013, 139.4808],
            seaCandle: [35.2998, 139.4789],
            kataseEnoshima: [35.3087, 139.4830],
            tonkatsusaito: [35.3087, 139.4830],
            // [NEW] Day 8 Locations
            ginza: [35.6712, 139.7665],
            ginzaBairin: [35.6705, 139.7645],
            narita: [35.7719, 140.3929]
        };

        const POIS = {
            denden: [
                { name: "ì¡°ì‹  ìŠˆí¼ í‚¤ì¦ˆ ëœë“œ", pos: [34.6595, 135.5055] },
                { name: "ì •ê¸€ (Jungle)", pos: [34.6600, 135.5060] },
                { name: "ìŠˆí¼ í¬í…Œì´í† ", pos: [34.6610, 135.5058] },
                { name: "ì• ë‹ˆë©”ì´íŠ¸", pos: [34.6605, 135.5050] },
                { name: "ìŠ¤ë£¨ê°€ì•¼", pos: [34.6590, 135.5052] },
                { name: "ë¼ì‹ ë°˜", pos: [34.6598, 135.5056] },
                { name: "ì˜¤íƒ€ë¡œë“œ", pos: [34.6590, 135.5065] },
                { name: "GEE Store", pos: [34.6630, 135.5045] },
                { name: "ì‹ ì¥ì„œì  (Shinjang)", pos: [34.6600, 135.5050] },
                { name: "ë§Œë‹¤ë¼ì¼€ ê·¸ëœë“œì¹´ì˜¤ìŠ¤", pos: [34.6730, 135.4995] },
                { name: "K-Books", pos: [34.6612, 135.5055] },
                { name: "í† ë¼ë…¸ì•„ë‚˜", pos: [34.6608, 135.5053] },
                { name: "Yellow Submarine", pos: [34.6615, 135.5058] },
                { name: "Volks Osaka Showroom", pos: [34.6620, 135.5060] },
                { name: "ìŠˆí¼ í¬í…Œì´í†  (ë ˆíŠ¸ë¡œ ê²Œì„)", pos: [34.6610, 135.5058] },
                { name: "ë ˆíŠ¸ë¡œ ê²Œì„ ìº í”„", pos: [34.6605, 135.5055] },
                { name: "ë¹„ë””ì˜¤ ê²Œì„ íƒì •ë‹¨ (Game Tanteidan)", pos: [34.6598, 135.5062] },
                { name: "ìŠ¤ë£¨ê°€ì•¼ ë‹›í°ë°”ì‹œì ", pos: [34.6590, 135.5052] },
                { name: "ì¡°ì‹  ìŠˆí¼ í‚¤ì¦ˆ ëœë“œ (ê±´ë‹´/ëª¨í˜•)", pos: [34.6595, 135.5055] },
                { name: "ë“œë˜ê³¤í€˜ìŠ¤íŠ¸ ë¡œì†", pos: [34.6592, 135.5068] }
            ],
            dotonbori_views: [
                { name: "ê¸€ë¦¬ì½”ìƒ (ë©”ì¸)", pos: [34.6687, 135.5013] },
                { name: "ì¹´ë‹ˆë„ë¼ì¿  (ì›€ì§ì´ëŠ” ê²Œ)", pos: [34.6687, 135.5013] },
                { name: "í‚¨ë¥˜ ë¼ë©˜ (ìš© ê°„íŒ)", pos: [34.6685, 135.5030] },
                { name: "ê²ë¡œì¿  ìŠ¤ì‹œ (ê±°ëŒ€ ìŠ¤ì‹œ)", pos: [34.6682, 135.5010] },
                { name: "ì˜¤ì‚¬ì¹´ ì˜¤ì‡¼ (ê±°ëŒ€ êµì)", pos: [34.6686, 135.5020] },
                { name: "ì¿ ì¿ ë£¨ (ê±°ëŒ€ ë¬¸ì–´)", pos: [34.6688, 135.5015] },
                { name: "ì¿ ì‹œì¹´ì¸  ë‹¤ë£¨ë§ˆ (ì•„ì €ì”¨)", pos: [34.6680, 135.5025] },
                { name: "ì¦ˆë³´ë¼ì•¼ (ë³µì–´ - íì—…í–ˆì§€ë§Œ ëœë“œë§ˆí¬)", pos: [34.6683, 135.5028] },
                { name: "ì‡¼ì¹˜ì¿ ì¢Œ (ê·¹ì¥)", pos: [34.6678, 135.5018] },
                { name: "ëˆí‚¤í˜¸í…Œ ê´€ëŒì°¨", pos: [34.6689, 135.5050] },
                { name: "íƒ€ì½”ì•¼í‚¤ ì™€ë‚˜ì¹´", pos: [34.6675, 135.5035] },
                { name: "ì•—ì¹˜ì¹˜ í˜¼í¬ (íƒ€ì½”ì•¼í‚¤)", pos: [34.6687, 135.5032] },
                { name: "ë¯¸ì¦ˆë…¸ (ì˜¤ì½”ë…¸ë¯¸ì•¼í‚¤)", pos: [34.6680, 135.5038] },
                { name: "í‚¨ë¥˜ ë¼ë©˜ (ìš© ê°„íŒ)", pos: [34.6685, 135.5030] },
                { name: "ì¿ ì´ë‹¤ì˜¤ë ˆ íƒ€ë¡œ (ë¶ì¹˜ëŠ” ì¸í˜•)", pos: [34.6682, 135.5028] }
            ],
            kuromon: [
                { name: "ë§ˆêµ¬ë¡œì•¼ ì¿ ë¡œê¸´ (ì°¸ì¹˜)", pos: [34.6655, 135.5075] },
                { name: "ë§ˆë£¨ì   ì‹ìœ¡ì  (ê³ ë² ê·œ)", pos: [34.6652, 135.5072] },
                { name: "ì´ì‹œë°”ì‹œ ì‹í’ˆ (ì˜¤ë…)", pos: [34.6656, 135.5077] },
                { name: "í™”ì´íŠ¸ ë”¸ê¸° & ë‘ìœ ", pos: [34.6650, 135.5076] },
                { name: "ìš°ì˜¤í›„ì¿  (ê°€ë¦¬ë¹„/ì„±ê²Œ)", pos: [34.6653, 135.5073] },
                { name: "ë§ˆë£¨ì   ì‹ìœ¡ì  (ê³ ë² ê·œ ê¼¬ì¹˜)", pos: [34.6652, 135.5072] },
                { name: "ì²œì§€ì¸ (ë¶€íƒ€ë™)", pos: [34.6645, 135.5068] },
                { name: "ì˜¤ë‹ˆì‹œ ìœ í†µ (ì•¼í‚¤ë‹ˆì¿  ê¼¬ì¹˜)", pos: [34.6658, 135.5078] },
                { name: "Minami (í›„êµ¬/ë³µì–´)", pos: [34.6655, 135.5080] }
            ],
            usj: [
                { name: "ìŠˆí¼ ë‹Œí…ë„ ì›”ë“œ", pos: [34.6655, 135.4330] },
                { name: "ìœ„ì €ë”© ì›”ë“œ (í•´ë¦¬í¬í„°)", pos: [34.6654, 135.4323] },
                { name: "ë¯¸ë‹ˆì–¸ íŒŒí¬", pos: [34.6654, 135.4320] },
                { name: "ì¥¬ë¼ê¸° ê³µì›", pos: [34.6644, 135.4306] }
            ],
            fushimi: [
                { name: "ì„¼ë³¸ í† ë¦¬ì´", pos: [34.9665, 135.7750] },
                { name: "ì˜¤ì¿ ìƒ¤ ë´‰ë°°ì†Œ", pos: [34.9660, 135.7760] },
                { name: "ê³°ì˜ ìˆ² (ì¿ ë§ˆíƒ€ì¹´ìƒ¤)", pos: [34.9655, 135.7780] },
                { name: "ìš”ì¸ ì¸ ì§€", pos: [34.9650, 135.7800] }
            ],
            kiyomizu: [
                { name: "ë³¸ë‹¹ (ë¬´ëŒ€)", pos: [34.9948, 135.7850] },
                { name: "ì˜¤í† ì™€ í­í¬", pos: [34.9945, 135.7852] }
            ],
            sannenzaka: [
                { name: "ìŠ¤íƒ€ë²…ìŠ¤ (ë‹¤ë‹¤ë¯¸)", pos: [34.9985, 135.7805] },
                { name: "ë™êµ¬ë¦¬ ê³µí™”êµ­", pos: [34.9965, 135.7815] },
                { name: "ë§ˆë¥´ë¸”ë‘ìŠˆ (ì°¨ë…¸ì¹´)", pos: [34.9958, 135.7825] },
                { name: "ìš”ì§€ì•¼", pos: [34.9962, 135.7818] },
                { name: "ì‹œì¹˜ë¯¸ì•¼ í˜¼í¬", pos: [34.9955, 135.7828] },
                { name: "ì´ë…¸ë‹¤ ì»¤í”¼", pos: [34.9960, 135.7810] },
                { name: "ì˜¤ì¹´ë£¨ (ì¹´ë ˆìš°ë™)", pos: [35.0038, 135.7745] },
                { name: "ì¹´ì‚¬ê¸°ì•¼ (ë‹¨íŒ¥ì£½)", pos: [34.9970, 135.7812] },
                { name: "í›„ì§€ë‚˜ë¯¸ (ë¯¸íƒ€ë¼ì‹œ ë‹¹ê³ )", pos: [34.9968, 135.7813] },
                { name: "Malebranche (ë…¹ì°¨ ì¿ í‚¤)", pos: [34.9958, 135.7825] },
                { name: "Seveneya (ì¹ ë¯¸)", pos: [34.9955, 135.7828] },
                { name: "ì•„ì‚¬íˆë„ (ë„ìê¸°)", pos: [34.9958, 135.7820] },
                { name: "ì¹´ì‡¼ê°€ë§ˆ ë„ì˜ˆ êµì‹¤", pos: [34.9965, 135.7818] },
                { name: "ì´ë…¸ë‹¤ ì»¤í”¼ (ë¶„ì )", pos: [34.9960, 135.7810] },
                { name: "ìš”ì§€ì•¼ (ê¸°ìš”ë¯¸ì¦ˆì )", pos: [34.9962, 135.7818] },
                { name: "ìŠ¤ëˆ„í”¼ ì´ˆì½œë¦¿", pos: [34.9972, 135.7813] }
            ],
            kamo_cafes: [
                { name: "ìŠ¤íƒ€ë²…ìŠ¤ ì‚°ì¡°ì˜¤í•˜ì‹œ", pos: [35.0090, 135.7718] },
                { name: "ì¹´ì™€ ì¹´í˜ (Kawa)", pos: [35.0015, 135.7705] },
                { name: "ì‚´ë¡± ë“œ ë¡œì–„", pos: [35.0110, 135.7715] },
                { name: ".S (ë‹· ì—ìŠ¤)", pos: [35.0130, 135.7725] }
            ],
            gion: [
                { name: "í•˜ë‚˜ë¯¸ì½”ì§€ (ë©”ì¸)", pos: [35.0035, 135.7750] },
                { name: "ì•¼ì‚¬ì¹´ ì‹ ì‚¬", pos: [35.0036, 135.7785] },
                { name: "ê¸°ì˜¨ ì¸ ì§€ë¦¬ (íŒŒë¥´í˜)", pos: [35.0038, 135.7742] },
                { name: "ì¹´ê¸°ì   ìš”ì‹œí›„ì‚¬", pos: [35.0039, 135.7748] },
                { name: "ê¸°ì˜¨ í‚¤ë‚˜ë‚˜", pos: [35.0025, 135.7755] },
                { name: "íƒ€ì¸ ë¯¸ ë‹¤ë¦¬", pos: [35.0055, 135.7735] },
                { name: "ë¯¸ë‚˜ë¯¸ì¢Œ (ê·¹ì¥)", pos: [35.0040, 135.7725] },
                { name: "ìš”ì§€ì•¼ (í™”ì¥í’ˆ)", pos: [35.0040, 135.7750] }
            ],
            pontocho: [
                { name: "í°í† ì´ˆ ê³¨ëª©", pos: [35.0062, 135.7716] },
                { name: "ìœ ì¦ˆê² (ìœ ìë‚˜ë² )", pos: [35.0058, 135.7715] },
                { name: "ëª¨ì¸ ë‚˜ë²  í† ë¼ì•¼", pos: [35.0060, 135.7715] },
                { name: "êµí†  ì•¼í‚¤ë‹ˆì¿  ì—”ì—”", pos: [35.0045, 135.7712] },
                { name: "ê°“íŒŒ ìŠ¤ì‹œ", pos: [35.0050, 135.7713] },
                { name: "í°í† ì´ˆ ê³µì›", pos: [35.0065, 135.7718] }
            ],
            sensoji: [
                { name: "ì¹´ë¯¸ë‚˜ë¦¬ëª¬ (ì œë“±)", pos: [35.7111, 139.7964] },
                { name: "í˜¸ì¡°ëª¬", pos: [35.7138, 139.7966] },
                { name: "ë³¸ë‹¹ (ê´€ìŒë‹¹)", pos: [35.7147, 139.7966] },
                { name: "ì•„ì‚¬ì¿ ì‚¬ ë°€ë ˆ ë©”ë ˆ (ì• í”ŒíŒŒì´)", pos: [35.7118, 139.7963] },
                { name: "ì•„ì‚¬ì¿ ì‚¬ ì‹ ì‚¬", pos: [35.7150, 139.7972] },
                { name: "ì˜¤ë¯¸ì¿ ì§€ êµ¬ì—­", pos: [35.7144, 139.7962] },
                { name: "í‚¤ë¬´ë¼ì•¼ (ì¸í˜•ë¹µ)", pos: [35.7140, 139.7965] },
                { name: "í‚¤ë¹„ë‹¹ê³  ì•„ì¦ˆë§ˆ", pos: [35.7125, 139.7965] },
                { name: "ì•„ì‚¬ì¿ ì‚¬ ì½”ì½”ë…¸ì—", pos: [35.7141, 139.7965] },
                { name: "í™”ì›”ë‹¹ (ë©”ë¡ ë¹µ)", pos: [35.7135, 139.7950] },
                { name: "ì‹¤í¬ í‘¸ë”©", pos: [35.7118, 139.7968] },
                { name: "í›„ë‚˜ì™€ (ì–‘ê°±)", pos: [35.7120, 139.7964] },
                { name: "ì¹´ê²Œì¸ ë„ (ì ë³´ ë©”ë¡ ë¹µ)", pos: [35.7135, 139.7950] },
                { name: "ì•„ì‚¬ì¿ ì‚¬ ë©˜ì¹˜ (ê³ ë¡œì¼€)", pos: [35.7128, 139.7958] },
                { name: "ìš”ë¡œì´ì•¼ ë¼ë©˜", pos: [35.7130, 139.7962] },
                { name: "ìš°ë©”ì¡°ë…¸ (ë””ì €íŠ¸/ë¹™ìˆ˜)", pos: [35.7125, 139.7955] }
            ],
            ameyoko: [
                { name: "ì‹œë¬´ë¼ ì‡¼í… (ì´ˆì½œë¦¿)", pos: [35.7095, 139.7745] },
                { name: "ë‹ˆì¿ ë…¸ ì˜¤ì˜¤ì•¼ë§ˆ", pos: [35.7100, 139.7742] },
                { name: "ë¯¸ë‚˜í† ì•¼ (ë®ë°¥)", pos: [35.7092, 139.7743] },
                { name: "ë‹¤ì´í† ë¥˜ (ì´ìì¹´ì•¼)", pos: [35.7098, 139.7744] },
                { name: "ì•¼í‚¤í† ë¦¬ ë¶„ë¼ì¿ ", pos: [35.7097, 139.7744] },
                { name: "í–ì¹´ì—” (ê³¼ì¼)", pos: [35.7090, 139.7742] },
                { name: "ABCë§ˆíŠ¸ ë³¸ì ", pos: [35.7088, 139.7745] },
                { name: "ë‹ˆí‚¤ì˜ ê³¼ì", pos: [35.7085, 139.7743] }
            ],
            kappabashi: [
                { name: "ë‹ˆì´ë¯¸ ì‹ê¸° (ìš”ë¦¬ì‚¬ ë™ìƒ)", pos: [35.7100, 139.7900] },
                { name: "ê°„ì†Œ ì‡¼ì¿ íŒ (ìŒì‹ëª¨í˜•)", pos: [35.7140, 139.7890] },
                { name: "ì¹´ë§ˆì•„ì‚¬ ìƒì  (ì¹¼/ë¬´ì‡ )", pos: [35.7130, 139.7895] },
                { name: "ë§ˆì§€ë§ˆì•¼ (ì¿ í‚¤ í‹€ íƒ€ì›Œ)", pos: [35.7135, 139.7896] },
                { name: "ìœ ë‹ˆì˜¨ (ì»¤í”¼ ìš©í’ˆ)", pos: [35.7115, 139.7898] },
                { name: "ì´ì´ë‹¤ì•¼ (ì¡°ë¦¬ ë„êµ¬)", pos: [35.7125, 139.7892] },
                { name: "ì¸ ë°”ì•¼ (ì¹¼ ì „ë¬¸)", pos: [35.7118, 139.7893] },
                { name: "ë´ê°€ë§ˆ (ì¼ë³¸ ê·¸ë¦‡)", pos: [35.7120, 139.7894] }
            ],
            akihabara: [
                { name: "ë¼ë””ì˜¤ íšŒê´€", pos: [35.6980, 139.7720] },
                { name: "ê²Œì´ë¨¸ì¦ˆ ë³¸ì ", pos: [35.6982, 139.7725] },
                { name: "ë§Œë‹¤ë¼ì¼€", pos: [35.7000, 139.7710] },
                { name: "ì• ë‹ˆë©”ì´íŠ¸", pos: [35.7005, 139.7715] },
                { name: "íŠ¸ë ˆì´ë” ë³¸ì ", pos: [35.7010, 139.7718] },
                { name: "ìŠ¤ë£¨ê°€ì•¼", pos: [35.6990, 139.7715] },
                { name: "HEY ì•„ì¼€ì´ë“œ", pos: [35.6995, 139.7705] },
                { name: "GIGO 3í˜¸ê´€", pos: [35.6992, 139.7710] },
                { name: "ì•„ë¯¸ì•„ë¯¸ 2í˜¸ì ", pos: [35.7008, 139.7722] },
                { name: "íŠ¸ë¼ì´ ì–´ë®¤ì¦ˆë¨¼íŠ¸ íƒ€ì›Œ (ì—ë®¤ì¦ˆíƒ€ì›Œ)", pos: [35.6995, 139.7705] }
            ],
            zojoji_view: [
                { name: "ì¡°ì¡°ì§€ ë³¸ë‹¹", pos: [35.6574, 139.7482] },
                { name: "ë„ì¿„íƒ€ì›Œ í¬í† ì¡´ (ê³„ë‹¨)", pos: [35.6565, 139.7490] },
                { name: "ì‹œë°” ê³µì› (í”¼í¬ë‹‰ ë·°)", pos: [35.6555, 139.7495] }
            ],
            shinjuku_night: [
                { name: "ê³ ì§ˆë¼ í—¤ë“œ (ê·¸ë ˆì´ìŠ¤ë¦¬)", pos: [35.6953, 139.7028] },
                { name: "ì˜¤ëª¨ì´ë° ìš”ì½”ì´ˆ (ê¼¬ì¹˜)", pos: [35.6930, 139.6995] },
                { name: "ê³¨ë“ ê°€ì´", pos: [35.6942, 139.7047] },
                { name: "ëˆí‚¤í˜¸í…Œ ê°€ë¶€í‚¤ì´ˆ", pos: [35.6940, 139.7025] }
            ],
            shibuya_attract: [
                { name: "ë‹Œí…ë„ ë„ì¿„ (Parco 6F)", pos: [35.6620, 139.6987] },
                { name: "ì í”„ìƒµ (Parco 6F)", pos: [35.6620, 139.6987] },
                { name: "í¬ì¼“ëª¬ ì„¼í„°", pos: [35.6620, 139.6987] },
                { name: "íœ´ë¨¼ ë©”ì´ë“œ (Parco 1F)", pos: [35.6620, 139.6987] },
                { name: "Kith Tokyo (Miyashita)", pos: [35.6615, 139.7020] },
                { name: "ë¯¸ì•¼ì‹œíƒ€ ê³µì› (ì˜¥ìƒ)", pos: [35.6615, 139.7020] }
            ],
            omotesando_shop: [
                { name: "ì˜¤ëª¨í…Œì‚°ë„ íì¦ˆ", pos: [35.6670, 139.7100] },
                { name: "ë©”ì¢… í‚¤ì¸ ë„¤", pos: [35.6650, 139.7130] },
                { name: "ì• í”Œ ì˜¤ëª¨í…Œì‚°ë„", pos: [35.6655, 139.7125] },
                { name: "ìì´ë ˆ(GYRE)", pos: [35.6665, 139.7075] },
                { name: "í‚¤ë””ëœë“œ (ìºë¦­í„°)", pos: [35.6675, 139.7065] },
                { name: "ë„í í”Œë¼ì (ì…êµ¬)", pos: [35.6695, 139.7030] },
                { name: "ìŠˆí”„ë¦¼ í•˜ë¼ì£¼ì¿ ", pos: [35.6705, 139.7035] }
            ],
            azabudai_shops: [
                { name: "% ì•„ë¼ë¹„ì¹´ (B1)", pos: [35.6605, 139.7410] },
                { name: "í ë¦¬ì¹¸ ì¹´í˜", pos: [35.6605, 139.7410] },
                { name: "í•˜ë¸ŒìŠ¤ (ì¼€ì´í¬)", pos: [35.6605, 139.7410] },
                { name: "íŒ€ë© ë§¤í‘œì†Œ", pos: [35.6608, 139.7408] }
            ],
            // [NEW] Day 7 Detailed POIs
            nakano_detailed: [
                { name: "ë§Œë‹¤ë¼ì¼€ ë³¸ì  (3F)", pos: [35.7089, 139.6657] },
                { name: "ë§Œë‹¤ë¼ì¼€ ìŠ¤í˜ì…œ (2F)", pos: [35.7089, 139.6657] },
                { name: "ë§Œë‹¤ë¼ì¼€ ë”¥ (Deep) (2F)", pos: [35.7089, 139.6657] },
                { name: "ë§Œë‹¤ë¼ì¼€ ê°¤ëŸ­ì‹œ (ê²Œì„)", pos: [35.7089, 139.6657] },
                { name: "ë§Œë‹¤ë¼ì¼€ í—¨ì•¼ (4F)", pos: [35.7089, 139.6657] },
                { name: "ë°ì¼ë¦¬ ì¹˜ì½” (ì†Œí”„íŠ¸í¬ë¦¼)", pos: [35.7089, 139.6657] },
                { name: "íŠ¸ë¦¬ì˜¤ (ì•„ì´ëŒ êµ¿ì¦ˆ)", pos: [35.7089, 139.6657] },
                { name: "í•˜ë¹„ ë² ì´ìŠ¤ (í”¼ê·œì–´)", pos: [35.7089, 139.6657] }
            ],
            akiba_deep_shopping: [
                { name: "ë¼ë””ì˜¤íšŒê´€ 4F (ì•„ë¯¸ì•„ë¯¸)", pos: [35.6980, 139.7720] },
                { name: "ë¼ë””ì˜¤íšŒê´€ 3F (K-Books)", pos: [35.6980, 139.7720] },
                { name: "ë¼ë””ì˜¤íšŒê´€ 2F (ì‡¼ì¼€ì´ìŠ¤)", pos: [35.6980, 139.7720] },
                { name: "íŠ¸ë ˆì´ë” ë³¸ì  (ë¯¸ì—°ì‹œ/ê²Œì„)", pos: [35.7010, 139.7718] },
                { name: "ë©œë¡ ë¶ìŠ¤ (ë™ì¸ì§€)", pos: [35.6990, 139.7715] },
                { name: "ìŠ¤ë£¨ê°€ì•¼ ì•„í‚¤í•˜ë°”ë¼ì—­ì ", pos: [35.6985, 139.7725] },
                { name: "ë¼ì‹ ë°˜ ì•„í‚¤í•˜ë°”ë¼", pos: [35.6995, 139.7713] },
                { name: "ì½”í† ë¶€í‚¤ì•¼", pos: [35.6998, 139.7711] },
                { name: "BEEP (ë ˆíŠ¸ë¡œ PC/ê²Œì„)", pos: [35.7015, 139.7712] },
                { name: "í¬íë°íƒ€ (ì² ë„ëª¨í˜•)", pos: [35.6995, 139.7708] },
                { name: "ìŠˆí¼ í¬í…Œì´í†  (ë ˆíŠ¸ë¡œê´€)", pos: [35.6992, 139.7705] },
                { name: "íƒ€ë§ˆì‹œ ë„¤ì´ì…˜ì¦ˆ (ë°˜ë‹¤ì´)", pos: [35.6985, 139.7725] }
            ],
            americamura: [
                { name: "BIG STEP", pos: [34.6720, 135.4990] },
                { name: "ì‚¼ê°ê³µì› (Sankaku)", pos: [34.6722, 135.4983] },
                { name: "ì½”ê°€ë¥˜ íƒ€ì½”ì•¼í‚¤", pos: [34.6723, 135.4982] },
                { name: "ë§Œë‹¤ë¼ì¼€ ê·¸ëœë“œì¹´ì˜¤ìŠ¤", pos: [34.6730, 135.4995] },
                { name: "SPINNS Vintage (ë¹ˆí‹°ì§€ ì˜ë¥˜)", pos: [34.6725, 135.4988] },
                { name: "KINJI (ëŒ€í˜• êµ¬ì œìƒµ)", pos: [34.6720, 135.4990] },
                { name: "Vancy (ë ˆíŠ¸ë¡œ ì†Œí’ˆ)", pos: [34.6718, 135.4985] },
                { name: "ì½”ê°€ë¥˜ (íƒ€ì½”ì•¼í‚¤ ë³¸ì )", pos: [34.6723, 135.4982] },
                { name: "Long Softcream (ì•„ì´ìŠ¤í¬ë¦¼)", pos: [34.6728, 135.4980] }
            ],
            shinsaibashi: [
                { name: "íŒŒë¥´ì½” (í¬ì¼“ëª¬/ì í”„)", pos: [34.6735, 135.5015] },
                { name: "ë‹¤ì´ë§ˆë£¨ ë°±í™”ì ", pos: [34.6738, 135.5012] },
                { name: "ìœ ë‹ˆí´ë¡œ í”Œë˜ê·¸ì‹­", pos: [34.6740, 135.5018] }
            ],
            nishiki: [
                { name: "ì¹´ì´ (íƒ€ì½”íƒ€ë§ˆê³ )", pos: [35.0050, 135.7640] },
                { name: "íƒ€ë‚˜ì¹´ ì¼€ì´ë€ (ê³„ë€)", pos: [35.0051, 135.7635] },
                { name: "ì½˜ë‚˜ëª¬ì (ë‘ìœ ë„ë„›)", pos: [35.0052, 135.7638] },
                { name: "ìŠ¤ëˆ„í”¼ ì°¨ì•¼", pos: [35.0053, 135.7632] },
                { name: "ë‹¤ì´ì•¼ìŠ¤ (ì¸ ì¼€ëª¨ë…¸/ì ˆì„)", pos: [35.0048, 135.7615] },
                { name: "ë¯¸í‚¤ ì¼€ì´ë€ (ê³„ë€ë§ì´)", pos: [35.0051, 135.7628] },
                { name: "ì˜¤ì´ìŠ¤í„° ë°” ë‹¤ì´ì•¼ìŠ¤", pos: [35.0049, 135.7618] },
                { name: "ì•„ë¦¬ì¸ êµ¬ (ì¹¼/ì¡°ë¦¬ë„êµ¬)", pos: [35.0052, 135.7625] }
            ],
            komachi: [
                { name: "Giraffa (ì¹´ë ˆë¹µ)", pos: [35.3210, 139.5515] },
                { name: "ë§ˆë©”ì•¼ (ì½©ê³¼ì)", pos: [35.3225, 139.5525] },
                { name: "ë™êµ¬ë¦¬ ê³µí™”êµ­", pos: [35.3218, 139.5520] },
                { name: "ì¹´ë§ˆì¿ ë¼ ì± ì°¨ (ë§ì°¨)", pos: [35.3195, 139.5505] }
            ],
            enoshima: [
                { name: "ì—ë…¸ì‹œë§ˆ ì‹ ì‚¬", pos: [35.3005, 139.4795] },
                { name: "ë²¤ìì´í… ë‚˜ì¹´ë¯¸ì„¸", pos: [35.3020, 139.4810] },
                { name: "ì´ì™€ì•¼ ë™êµ´", pos: [35.2975, 139.4760] },
                { name: "ì”¨ìº”ë“¤ (ì „ë§ëŒ€)", pos: [35.2998, 139.4789] },
                { name: "i-na cafe (í”„ë Œì¹˜ í† ìŠ¤íŠ¸)", pos: [35.3025, 139.4820] },
                { name: "LonCafe (ì¼ë³¸ ìµœì´ˆ í”„ë Œì¹˜í† ìŠ¤íŠ¸)", pos: [35.2990, 139.4780] },
                { name: "í† ë¹—ì´ˆ (ì‹œë¼ìŠ¤ë™)", pos: [35.3015, 139.4815] },
                { name: "ì—ë…¸ì‹œë§ˆ í…Œì´ (ë°”ë‹¤ ë·°)", pos: [35.2985, 139.4770] }
            ],
            nakano_shops: [
                { name: "ë§Œë‹¤ë¼ì¼€ ë³¸ì ", pos: [35.7089, 139.6657] },
                { name: "ì‚¬ë¼ë¼ (ë§Œë‹¤ë¼ì¼€)", pos: [35.7090, 139.6658] },
                { name: "Robot Robot", pos: [35.7088, 139.6656] },
                { name: "TOY BARN", pos: [35.7087, 139.6659] },
                { name: "ë¼ì‹ ë°˜", pos: [35.7086, 139.6655] },
                { name: "Jackroad (ì‹œê³„ ì „ë¬¸)", pos: [35.7089, 139.6657] },
                { name: "Cube Style (í”¼ê·œì–´ ìœ„íƒ)", pos: [35.7089, 139.6658] },
                { name: "ê°€ì± ê°€ì±  (ìº¡ìŠí† ì´)", pos: [35.7089, 139.6656] },
                { name: "í›„ì§€ì•¼ í˜ì½”ì§± (ê¸°ë…í’ˆ)", pos: [35.7089, 139.6655] }
            ],
            tokyo_char: [
                { name: "í¬ì¼“ëª¬ ìŠ¤í† ì–´", pos: [35.6812, 139.7675] },
                { name: "ì í”„ìƒµ", pos: [35.6813, 139.7674] },
                { name: "ë™êµ¬ë¦¬ ê³µí™”êµ­", pos: [35.6811, 139.7676] },
                { name: "ì»¤ë¹„ ì¹´í˜ ì˜ë ", pos: [35.6814, 139.7673] }
            ],
            ginza_shop: [
                { name: "ìœ ë‹ˆí´ë¡œ (12F)", pos: [35.6712, 139.7665] },
                { name: "ì´í† ì•¼ (ë¬¸êµ¬)", pos: [35.6725, 139.7680] },
                { name: "ë¯¸ì¸ ì½”ì‹œ ë°±í™”ì ", pos: [35.6718, 139.7670] },
                { name: "ë„ë²„ ìŠ¤íŠ¸ë¦¬íŠ¸ ë§ˆì¼“", pos: [35.6698, 139.7635] },
                { name: "ì¹´í˜ ë“œ ëŒë¸Œë¥´ (ì „ì„¤ì˜ ì»¤í”¼)", pos: [35.6695, 139.7650] },
                { name: "ì´í† ì•¼ (ëŒ€í˜• ë¬¸êµ¬ì )", pos: [35.6725, 139.7680] },
                { name: "ê¸´ì ì›¨ìŠ¤íŠ¸ (ë””ì €íŠ¸)", pos: [35.6705, 139.7620] },
                { name: "ì‚°ë¦¬ì˜¤ ì›”ë“œ ê¸´ì", pos: [35.6735, 139.7655] }
            ],
            osaka_hotel_nearby: [
                { name: "íŒ¨ë°€ë¦¬ë§ˆíŠ¸ ë‚œë°”ë‚˜ì¹´", pos: [34.6635, 135.5010] },
                { name: "ì„¸ë¸ì¼ë ˆë¸ ëª¨í† ë§ˆì¹˜ 2ì´ˆë©”", pos: [34.6640, 135.4970] },
                { name: "ë‚œë°” ì•¼ì‚¬ì¹´ ì‹ ì‚¬ (ì‚¬ì ë¨¸ë¦¬)", pos: [34.6625, 135.4965] },
                { name: "ë‚œë°” íŒŒí¬ìŠ¤", pos: [34.6615, 135.5020] }
            ],
            ueno_hotel_nearby: [
                { name: "ì„¸ë¸ì¼ë ˆë¸ íƒ€ì´í†  ìš°ì—ë…¸ 2ì´ˆë©”", pos: [35.7075, 139.7740] },
                { name: "íŒ¨ë°€ë¦¬ë§ˆíŠ¸ ìš°ì—ë…¸ ë‚˜ì¹´ë§ˆì¹˜", pos: [35.7080, 139.7735] },
                { name: "ì—…ë¬´ìŠˆí¼ (Gyomu Super)", pos: [35.7195, 139.7785] },
                { name: "ì´ë¦¬ì•¼ ì‹ë‹¹", pos: [35.7205, 139.7820] }
            ],
            shin_osaka_ekiben: [
                { name: "ì—í‚¤ë²¤ ë‹ˆê¸°ì™€ì´ (ì—­ë„ì‹œë½)", pos: [34.7335, 135.5005] },
                { name: "551 í˜¸ë¼ì´ (ë§Œë‘)", pos: [34.7338, 135.5008] },
                { name: "ì¿ ì‹œì¹´ì¸  ë‹¤ë£¨ë§ˆ (í¬ì¥)", pos: [34.7332, 135.5002] },
                { name: "ë¦¬ì¿ ë¡œ ì˜¤ì§€ìƒ (ì¹˜ì¦ˆì¼€ì´í¬)", pos: [34.7335, 135.5005] }
            ],
            kamehachi: [
                { name: "ì¿„ ëª¨ì¸ ë‚˜ë²  ì¹´ë©”í•˜ì¹˜ ë³¸ì ", pos: [35.0075, 135.7712] }
            ],
            honda_akiba: [
                { name: "ë©˜ë„ì½”ë¡œ í˜¼ë‹¤ ì•„í‚¤í•˜ë°”ë¼", pos: [35.6985, 139.7745] }
            ]
        };

        const RAW_DATA = [
            {
                day: 1,
                items: [
                    { time: "00:00 - 04:00", title: "ì·¨ì¹¨", loc: null, desc: "íœ´ì‹" },
                    { time: "04:00 - 06:00", title: "ê¸°ìƒ ë° ê³µí•­ ì¶œë°œ", loc: null, desc: "ì¤€ë¹„ í›„ ì´ë™" },
                    { time: "06:00 - 07:30", title: "ê³µí•­ ë„ì°© ë° íƒ‘ìŠ¹", loc: LOC.kix, desc: "MM172í¸ (07:30~09:15)" },
                    { time: "07:30 - 09:30", title: "ì˜¤ì‚¬ì¹´ ê°„ì‚¬ì´ ê³µí•­ ë„ì°©", loc: LOC.kix, desc: "ì…êµ­ ì‹¬ì‚¬ ë° ì§ ì°¾ê¸°" },
                    { time: "09:30 - 09:43", title: "í‘œ êµ¬ë§¤(ë‚œì¹´ì´ ê³µí•­ì„ )", price: 980, loc: LOC.kix, desc: "ë‚œë°”í–‰ í‹°ì¼“ êµ¬ë§¤" },
                    { time: "09:43 - 10:34", title: "ê¸°ì°¨ ì´ë™ (ë‚œë°”ì—­ ë„ì°©)", type: "move", transport: "train", from: LOC.kix, to: LOC.nambaStn, desc: "ë‚œì¹´ì´ ê³µí•­ì„  íƒ‘ìŠ¹" },
                    { time: "10:34 - 10:50", title: "ë‚œë°”ì—­ â†’ ìˆ™ì†Œ (ë„ë³´)", type: "move", transport: "walk", from: LOC.nambaStn, to: LOC.osakaHotel, desc: "ì§ ë³´ê´€í•˜ëŸ¬ ì´ë™ (ì˜¤ì‚¬ì¹´ ëª¨í† ë§ˆì¹˜)" },
                    { time: "10:50 - 11:05", title: "ìˆ™ì†Œ ì§ ë³´ê´€", loc: LOC.osakaHotel, pois: POIS.osaka_hotel_nearby, desc: "556-0016 Naniwa Ward (ê·¼ì²˜ í¸ì˜ì /ì‹ ì‚¬ í™•ì¸)" },
                    { time: "11:05 - 11:45", title: "í…ë™ ë§ˆí‚¤ë…¸ ì´ë™ & ì›¨ì´íŒ…", type: "move", transport: "walk", from: LOC.osakaHotel, to: LOC.tendonMakino, desc: "ì ì‹¬ ëŒ€ê¸°" },
                    { time: "11:45 - 12:25", title: "ì ì‹¬: í…ë™ ë§ˆí‚¤ë…¸", price: 2400, loc: LOC.tendonMakino, desc: "í…ë™ ìŒë¯¸" },
                    { time: "12:25 - 12:40", title: "ë´ë´íƒ€ìš´ìœ¼ë¡œ ì´ë™", type: "move", transport: "walk", from: LOC.tendonMakino, to: LOC.dendenTown, desc: "ë„ë³´ ì´ë™" },
                    { time: "12:40 - 14:45", title: "ë´ë´íƒ€ìš´ ê´€ëŒ", loc: LOC.dendenTown, pois: POIS.denden, desc: "í‚¤ì¦ˆëœë“œ, ì •ê¸€, ìŠˆí¼í¬í…Œì´í† , ì• ë‹ˆë©”ì´íŠ¸, ì˜¤íƒ€ë¡œë“œ" },
                    { time: "14:45 - 15:00", title: "ë‚œë°”ë¡œ ë³µê·€", type: "move", transport: "walk", from: LOC.dendenTown, to: LOC.nambaStn, desc: "ë„ë³´ ì´ë™" },
                    { time: "15:00 - 15:15", title: "í›„ë°œëŒ€ í•©ë¥˜", loc: LOC.nambaStn, desc: "ì¼í–‰ ë§Œë‚¨" },
                    { time: "15:15 - 15:30", title: "ê¸€ë¦¬ì½”ìƒìœ¼ë¡œ ì´ë™", type: "move", transport: "walk", from: LOC.nambaStn, to: LOC.glicoMan, desc: "ë„ë³´ ì´ë™" },
                    { time: "15:30 - 16:15", title: "ê¸€ë¦¬ì½”ìƒ & ì‹ ì‚¬ì´ë°”ì‹œ", loc: LOC.glicoMan, pois: [...POIS.americamura, ...POIS.shinsaibashi], desc: "ê¸€ë¦¬ì½”ìƒ, ì•„ë©”ë¦¬ì¹´ë¬´ë¼, ì‹ ì‚¬ì´ë°”ì‹œ êµ¬ê²½" },
                    { time: "16:15 - 16:45", title: "ê°„íŒ íˆ¬ì–´ (êµ¬ë¡œëª¬ ì´ë™)", type: "move", transport: "walk", from: LOC.glicoMan, to: LOC.kuromon, pois: POIS.dotonbori_views, desc: "ì¹´ë‹ˆë„ë¼ì¿ , í‚¨ë¥˜ë¼ë©˜, ê²ë¡œì¿ ìŠ¤ì‹œ ë“±" },
                    { time: "16:45 - 17:45", title: "êµ¬ë¡œëª¬ ì‹œì¥ êµ¬ê²½", loc: LOC.kuromon, pois: POIS.kuromon, desc: "ë§ˆêµ¬ë¡œì•¼ ì¿ ë¡œê¸´(ì°¸ì¹˜), ë§ˆë£¨ì  , ê°€ë¦¬ë¹„, í™”ì´íŠ¸ ë”¸ê¸°" },
                    { time: "17:45 - 18:00", title: "ì•„ë¶€ë¦¬ì•¼ë¡œ ì´ë™", type: "move", transport: "walk", from: LOC.kuromon, to: LOC.aburiya, desc: "ì €ë… ì¥ì†Œ ì´ë™" },
                    { time: "18:00 - 19:30", title: "ì €ë…: ì•„ë¶€ë¦¬ì•¼", price: 4900, loc: LOC.aburiya, desc: "ì•¼í‚¤ë‹ˆì¿  ì‹ì‚¬ (ì˜ˆì•½ì™„ë£Œ)" },
                    { time: "19:30 - 21:00", title: "ë„í†¤ë³´ë¦¬ ì•¼ê²½ & ê°„ì‹", loc: LOC.dotonbori, desc: "ëˆí‚¤í˜¸í…Œ ê°„ì‹ êµ¬ë§¤ (ë‚´ì¼ ì•„ì¹¨ìš©)" },
                    { time: "21:00 - 22:00", title: "ì•¼ì‹: ìŠ¤ë¯¸ë¹„ì•¼í‚¤í† ë¦¬í† ", loc: LOC.sumibi, desc: "ê¼¬ì¹˜êµ¬ì´ (ì˜ˆì•½X, ìƒí™© ë´ì„œ)" },
                    { time: "22:00 - 22:15", title: "ìˆ™ì†Œ ë³µê·€", type: "move", transport: "walk", from: LOC.sumibi, to: LOC.osakaHotel, desc: "ë„ë³´ ì´ë™" },
                    { time: "22:15 - 24:00", title: "ì·¨ì¹¨", loc: LOC.osakaHotel, desc: "íœ´ì‹" }
                ],
                items_shopping: [
                    { time: "13:00 - 13:30", title: "ë‚œë°”ì—­ ë„ì°©", loc: LOC.nambaStn, desc: "í›„ë°œëŒ€ ì˜¤ì‚¬ì¹´ ë„ì°©" },
                    { time: "13:30 - 14:00", title: "ì´ë™ ë° ëŒ€ê¸°", type: "move", transport: "walk", from: LOC.nambaStn, to: LOC.tendonMakino, desc: "í…ë™ ë§ˆí‚¤ë…¸ë¡œ ì´ë™" },
                    { time: "14:00 - 14:45", title: "ì ì‹¬: í…ë™ ë§ˆí‚¤ë…¸", price: 2400, loc: LOC.tendonMakino, desc: "ì‹ì‚¬ í›„ ì„ ë°œëŒ€ í•©ë¥˜ ëŒ€ê¸°" },
                    { time: "14:45 - 15:00", title: "ë‚œë°”ë¡œ ì´ë™", type: "move", transport: "walk", from: LOC.tendonMakino, to: LOC.nambaStn, desc: "ë„ë³´ ì´ë™" },
                    { time: "15:00 - 15:15", title: "ì„ ë°œëŒ€ í•©ë¥˜", loc: LOC.nambaStn, desc: "ë‚œë°”ì—­ ë¶€ê·¼ì—ì„œ í•©ë¥˜" },
                    { time: "15:15 - 15:30", title: "ê¸€ë¦¬ì½”ìƒìœ¼ë¡œ ì´ë™", type: "move", transport: "walk", from: LOC.nambaStn, to: LOC.glicoMan, desc: "ë„ë³´ ì´ë™" },
                    { time: "15:30 - 16:15", title: "ê¸€ë¦¬ì½”ìƒ & ì‹ ì‚¬ì´ë°”ì‹œ", loc: LOC.glicoMan, pois: [...POIS.americamura, ...POIS.shinsaibashi], desc: "ê¸€ë¦¬ì½”ìƒ, ì•„ë©”ë¦¬ì¹´ë¬´ë¼, ì‹ ì‚¬ì´ë°”ì‹œ êµ¬ê²½" },
                    { time: "16:15 - 16:45", title: "ê°„íŒ íˆ¬ì–´ (êµ¬ë¡œëª¬ ì´ë™)", type: "move", transport: "walk", from: LOC.glicoMan, to: LOC.kuromon, pois: POIS.dotonbori_views, desc: "ì¹´ë‹ˆë„ë¼ì¿ , í‚¨ë¥˜ë¼ë©˜, ê²ë¡œì¿ ìŠ¤ì‹œ ë“±" },
                    { time: "16:45 - 17:45", title: "êµ¬ë¡œëª¬ ì‹œì¥ êµ¬ê²½", loc: LOC.kuromon, pois: POIS.kuromon, desc: "ë§ˆêµ¬ë¡œì•¼ ì¿ ë¡œê¸´(ì°¸ì¹˜), ë§ˆë£¨ì  , ê°€ë¦¬ë¹„, í™”ì´íŠ¸ ë”¸ê¸°" },
                    { time: "17:45 - 18:00", title: "ì•„ë¶€ë¦¬ì•¼ë¡œ ì´ë™", type: "move", transport: "walk", from: LOC.kuromon, to: LOC.aburiya, desc: "ì €ë… ì¥ì†Œ ì´ë™" },
                    { time: "18:00 - 19:30", title: "ì €ë…: ì•„ë¶€ë¦¬ì•¼", price: 4900, loc: LOC.aburiya, desc: "ì•¼í‚¤ë‹ˆì¿  ì‹ì‚¬ (ì˜ˆì•½ì™„ë£Œ)" },
                    { time: "19:30 - 21:00", title: "ë„í†¤ë³´ë¦¬ ì•¼ê²½ & ê°„ì‹", loc: LOC.dotonbori, desc: "ëˆí‚¤í˜¸í…Œ ê°„ì‹ êµ¬ë§¤ (ë‚´ì¼ ì•„ì¹¨ìš©)" },
                    { time: "21:00 - 22:00", title: "ì•¼ì‹: ìŠ¤ë¯¸ë¹„ì•¼í‚¤í† ë¦¬í† ", loc: LOC.sumibi, desc: "ê¼¬ì¹˜êµ¬ì´ (ì˜ˆì•½X, ìƒí™© ë´ì„œ)" },
                    { time: "22:00 - 22:15", title: "ìˆ™ì†Œ ë³µê·€", type: "move", transport: "walk", from: LOC.sumibi, to: LOC.osakaHotel, desc: "ë„ë³´ ì´ë™" },
                    { time: "22:15 - 24:00", title: "ì·¨ì¹¨", loc: LOC.osakaHotel, desc: "íœ´ì‹" }
                ]
            },
            {
                day: 2,
                items: [
                    { time: "00:00 - 05:00", title: "ì·¨ì¹¨", loc: LOC.osakaHotel, desc: "íœ´ì‹" },
                    { time: "05:00 - 06:00", title: "ê¸°ìƒ ë° ì•„ì¹¨ì‹ì‚¬", loc: LOC.osakaHotel, desc: "ì¤€ë¹„ ë° ì•„ì¹¨" },
                    { time: "06:00 - 06:15", title: "ë‚œë°”ì—­ìœ¼ë¡œ ì´ë™", type: "move", transport: "walk", from: LOC.osakaHotel, to: LOC.nambaStn, desc: "ë„ë³´ ì´ë™" },
                    { time: "06:15 - 07:15", title: "USJ ê²Œì´íŠ¸ë¡œ ì´ë™", price: 370, type: "move", transport: "train", from: LOC.nambaStn, to: LOC.usj, desc: "ì˜¤í”ˆëŸ° (í•œì‹ /JR)" },
                    { time: "07:15 - 08:15", title: "ëŒ€ê¸°", loc: LOC.usj, desc: "ì…ì¥ ëŒ€ê¸°" },
                    { time: "08:15 - 10:30", title: "USJ êµ¬ê²½ (ì˜¤ì „)", loc: LOC.usj, pois: POIS.usj, desc: "ë‹Œí…ë„, í•´ë¦¬í¬í„°, ë¯¸ë‹ˆì–¸ ë“±" },
                    { time: "10:30 - 11:30", title: "ì ì‹¬ì‹ì‚¬", price: 2000, loc: LOC.usj, desc: "íŒŒí¬ ë‚´ ì‹ì‚¬" },
                    { time: "11:30 - 19:00", title: "USJ êµ¬ê²½ (ì˜¤í›„)", loc: LOC.usj, desc: "í—ë¦¬ìš°ë“œ, ì›Œí„°ì›”ë“œ ë“± ì–´íŠ¸ë™ì…˜" },
                    { time: "19:00 - 20:00", title: "ë‚œë°”ë¡œ ì´ë™", price: 370, type: "move", transport: "train", from: LOC.usj, to: LOC.nambaStn, desc: "ì „ì²  ì´ë™" },
                    { time: "20:00 - 20:10", title: "ì‹ë‹¹ìœ¼ë¡œ ì´ë™", type: "move", transport: "walk", from: LOC.nambaStn, to: LOC.atthe21, desc: "ë„ë³´ ì´ë™" },
                    { time: "20:00 - 21:00", title: "ì €ë…: at the 21", price: 2500, loc: LOC.atthe21, desc: "ì˜¤ì½”ë…¸ë¯¸ì•¼í‚¤/ì•¼í‚¤ì†Œë°” ë§›ì§‘ (3.45)" },
                    { time: "21:00 - 21:15", title: "ìˆ™ì†Œ ë³µê·€", type: "move", transport: "walk", from: LOC.atthe21, to: LOC.osakaHotel, desc: "ë„ë³´ ì´ë™" },
                    { time: "21:15 - 24:00", title: "ì·¨ì¹¨", loc: LOC.osakaHotel, desc: "íœ´ì‹" }
                ]
            },
            {
                day: 3,
                items: [
                    { time: "00:00 - 06:00", title: "ì·¨ì¹¨", loc: LOC.osakaHotel, desc: "íœ´ì‹" },
                    { time: "06:00 - 07:30", title: "ê¸°ìƒ ë° ì•„ì¹¨ì‹ì‚¬", price: 780, loc: LOC.nambaStn, desc: "ì¶”ì²œ: ì‹ íŒŒì¹˜ ì‹ë‹¹, í•˜ì½”ìœ ë©”, ì•Œí”„í—¤ì„, ìš”ì‹œë…¸ì•¼" },
                    { time: "07:30 - 08:45", title: "ë‚œë°”ì—­ìœ¼ë¡œ ì´ë™", type: "move", transport: "walk", from: LOC.osakaHotel, to: LOC.nambaStn, desc: "ìˆ™ì†Œ â†’ ë‚œë°”ì—­" },
                    { time: "08:45 - 09:15", title: "í›„ì‹œë¯¸ ì´ë‚˜ë¦¬ ì‹ ì‚¬ë¡œ ì´ë™", type: "move", transport: "train", from: LOC.nambaStn, to: LOC.fushimiInari, desc: "ì „ì²  ì´ë™" },
                    { time: "09:15 - 10:00", title: "í›„ì‹œë¯¸ ì´ë‚˜ë¦¬ ì‹ ì‚¬ ê´€ëŒ", loc: LOC.fushimiInari, pois: POIS.fushimi, desc: "ì˜¤ì¿ ìƒ¤ ë´‰ë°°ì†Œ â†’ ê³°ì˜ ìˆ² â†’ ë¯¸ì¸ ì¸ ì§€ â†’ ìš”ì¸ ì¸ ì§€ â†’ í•˜ì‚°" },
                    { time: "10:00 - 10:45", title: "ì•¼ë§ˆëª¨í†  ë©˜ì¡°ìš°ë¡œ ì´ë™", price: 1200, type: "move", transport: "train", from: LOC.fushimiInari, to: LOC.yamamoto, desc: "ì „ì² /ë²„ìŠ¤ ì´ë™" },
                    { time: "10:45 - 12:30", title: "ì ì‹¬: ì•¼ë§ˆëª¨í†  ë©˜ì¡°ìš°", price: 1200, loc: LOC.yamamoto, desc: "ìš°ë™ ë§›ì§‘ (10:45 ì˜ˆì•½), ì˜ˆì•½ ì‹¤íŒ¨ì‹œ ì†Œë°”ì§‘" },
                    { time: "12:30 - 13:00", title: "ê¸°ìš”ë¯¸ì¦ˆí…Œë¼ë¡œ ì´ë™", type: "move", transport: "train", from: LOC.yamamoto, to: LOC.kiyomizu, desc: "ë²„ìŠ¤/ë„ë³´ ì´ë™" },
                    { time: "13:00 - 14:30", title: "ê¸°ìš”ë¯¸ì¦ˆí…Œë¼ ê´€ëŒ", loc: LOC.kiyomizu, pois: POIS.kiyomizu, desc: "ë³¸ë‹¹ ë¬´ëŒ€ì™€ ì˜¤í† ì™€ í­í¬" },
                    { time: "14:30 - 15:30", title: "ì‚°ë„¨ìì¹´ & ë‹ˆë„¨ìì¹´ ê±°ë¦¬ íˆ¬ì–´", loc: LOC.sannenzaka, pois: POIS.sannenzaka, desc: "ê±°ë¦¬ íˆ¬ì–´" },
                    { time: "15:30 - 16:00", title: "ì‚°ì¡° ì˜¤í•˜ì‹œë¡œ ì´ë™", type: "move", transport: "walk", from: LOC.sannenzaka, to: LOC.kamoRiver, desc: "ë„ë³´ ì´ë™" },
                    { time: "16:00 - 16:50", title: "ê°€ëª¨ê°• íœ´ì‹", loc: LOC.kamoRiver, pois: POIS.kamo_cafes, desc: "ìŒë£Œ í…Œì´í¬ì•„ì›ƒ í›„ íœ´ì‹ (ìŠ¤íƒ€ë²…ìŠ¤, ë¸”ë£¨ë³´í‹€ ë“±)" },
                    { time: "16:50 - 17:30", title: "ë‹ˆì‹œí‚¤ ì‹œì¥ êµ¬ê²½", loc: LOC.nishiki, pois: POIS.nishiki, desc: "ì‹œì¥ ë¨¹ê±°ë¦¬ êµ¬ê²½ (ê³„ë€, ë‘ìœ ë„ë„›)" },
                    { time: "17:30 - 18:30", title: "ì €ë…1: ì¿„ ëª¨ì¸ ë‚˜ë²  ì¹´ë©”í•˜ì¹˜ ë³¸ì ", price: 3500, loc: LOC.kamehachi, pois: POIS.kamehachi, desc: "êµí†  ìµœê³ ì˜ ëª¨ì¸ ë‚˜ë²  (í°í† ì´ˆ)" },
                    { time: "18:30 - 19:30", title: "ë°¤ì˜ ê¸°ì˜¨ì‹œì¡° ë° í°í† ì´ˆ êµ¬ê²½", loc: LOC.gion, pois: [...POIS.gion, ...POIS.pontocho], desc: "í•˜ë‚˜ë¯¸ì½”ì§€, ì•¼ì‚¬ì¹´ì‹ ì‚¬, í°í† ì´ˆ" },
                    { time: "19:30 - 20:30", title: "ì €ë…2: Bingo", price: 3000, loc: LOC.bingo, desc: "ì¸ìŠ¤íƒ€ DM ì˜ˆì•½ (ë¯¼ì„±)" },
                    { time: "20:30 - 22:00", title: "ë‚œë°”ë¡œ ì´ë™", type: "move", transport: "train", from: LOC.bingo, to: LOC.nambaStn, desc: "ì˜¤ì‚¬ì¹´ ë³µê·€" },
                    { time: "22:00 - 24:00", title: "ë¼ìš´ë“œì› ë°©ë¬¸ or íœ´ì‹", loc: LOC.roundOne, desc: "ê²Œì„ ë° ì•¡í‹°ë¹„í‹°" }
                ]
            },
            {
                day: 4,
                items: [
                    { time: "00:00 - 01:00", title: "ë¼ìš´ë“œì› ì¢…ë£Œ í›„ ìˆ™ì†Œ ë³µê·€", type: "move", transport: "walk", from: LOC.roundOne, to: LOC.osakaHotel, desc: "ì‹¬ì•¼ ë„ë³´ ì´ë™" },
                    { time: "01:00 - 09:00", title: "ì·¨ì¹¨", loc: LOC.osakaHotel, desc: "ë§ˆì§€ë§‰ ë°¤" },
                    { time: "09:00 - 10:20", title: "ê¸°ìƒ ë° ì•„ì¹¨(ì½”ë©”ë‹¤)", loc: LOC.nambaStn, desc: "ì½”ë©”ë‹¤ ì»¤í”¼ ë“±" },
                    { time: "10:20 - 10:46", title: "ì‹ ì˜¤ì‚¬ì¹´ ì—­ìœ¼ë¡œ ì´ë™", price: 290, type: "move", transport: "train", from: LOC.nambaStn, to: LOC.shinOsaka, desc: "ì§€í•˜ì²  ì´ë™ (ë¯¸ë„ìŠ¤ì§€ì„ )" },
                    { time: "10:46 - 11:06", title: "ì—í‚¤ë²¤ êµ¬ë§¤", loc: LOC.shinOsaka, pois: POIS.shin_osaka_ekiben, desc: "ë‹ˆê¸°ì™€ì´, 551í˜¸ë¼ì´, ë‹¤ë£¨ë§ˆ ë“±" },
                    { time: "11:06 - 13:33", title: "ë„ì¿„í–‰ ì‹ ì¹¸ì„¼ ì´ë™", price: 14720, type: "move", transport: "train", from: LOC.shinOsaka, to: LOC.tokyoStn, desc: "ê¸°ì°¨ ë‚´ ì—í‚¤ë²¤ ì‹ì‚¬" },
                    { time: "13:33 - 14:00", title: "ë„ì¿„ì—­ â†’ ìˆ™ì†Œ ì´ë™", price: 170, type: "move", transport: "train", from: LOC.tokyoStn, to: LOC.uenoHotel, pois: POIS.ueno_hotel_nearby, desc: "ìš°ì—ë…¸(ë„¤ê¸°ì‹œ) ì´ë™ ë° ìˆ™ì†Œ ì£¼ë³€ í™•ì¸" },
                    { time: "14:00 - 14:20", title: "ë„êµ¬ê±°ë¦¬ ì´ë™", type: "move", transport: "walk", from: LOC.uenoHotel, to: LOC.kappabashi, desc: "ë„ë³´" },
                    { time: "14:20 - 15:20", title: "ê°“íŒŒë°”ì‹œ ë„êµ¬ê±°ë¦¬", loc: LOC.kappabashi, pois: POIS.kappabashi, desc: "ë‹ˆì´ë¯¸, ë§ˆì§€ë§ˆì•¼, ìœ ë‹ˆì˜¨ ë“± ê´€ëŒ" },
                    { time: "15:20 - 15:40", title: "ì„¼ì†Œì§€ë¡œ ì´ë™", type: "move", transport: "walk", from: LOC.kappabashi, to: LOC.sensoji, desc: "ë„ë³´" },
                    { time: "15:40 - 17:00", title: "ì„¼ì†Œì§€ & ë‚˜ì¹´ë¯¸ì„¸ë„ë¦¬", loc: LOC.sensoji, pois: POIS.sensoji, desc: "ì¹´ë¯¸ë‚˜ë¦¬ëª¬, ë°€ë ˆ ë©”ë ˆ(ì• í”ŒíŒŒì´), ë©˜ì¹˜ì¹´ì¸  ë“±" },
                    { time: "17:00 - 17:30", title: "ì•„í‚¤í•˜ë°”ë¼ë¡œ ì´ë™", price: 210, type: "move", transport: "train", from: LOC.sensoji, to: LOC.akihabara, desc: "ì¸ ì¿ ë°” ìµìŠ¤í”„ë ˆìŠ¤ ë“±" },
                    { time: "17:30 - 19:00", title: "ì•„í‚¤í•˜ë°”ë¼ êµ¬ê²½", loc: LOC.akihabara, pois: POIS.akihabara, desc: "ë¼ë””ì˜¤íšŒê´€, ì• ë‹ˆë©”ì´íŠ¸ ë“± (ì‹œê°„ í™•ëŒ€)" },
                    {
                        time: "19:00 - 20:30",
                        title: "ì €ë…: ë©˜ë„ì½”ë¡œ í˜¼ë‹¤",
                        loc: LOC.honda_akiba,
                        pois: POIS.honda_akiba,
                        price: 1300,
                        desc: "ì•„í‚¤í•˜ë°”ë¼ ì‡¼ìœ  ë¼ë©˜ ë§›ì§‘ (ì›¨ì´íŒ… í•„ìˆ˜)"
                    },
                    { time: "20:30 - 21:00", title: "ì•„ë©”ìš”ì½”ë¡œ ì´ë™", type: "move", transport: "walk", from: LOC.honda_akiba, to: LOC.ameyoko, desc: "ë„ë³´" },
                    { time: "21:00 - 24:00", title: "ì´ìì¹´ì•¼ ë’·í’€ì´", loc: LOC.ameyoko, pois: POIS.ameyoko, desc: "ë§¤ì¥ ì°¾ì•„ì•¼ í•¨" }
                ]
            },
            {
                day: 5,
                items: [
                    { time: "08:00 - 10:00", title: "ê¸°ìƒ ë° ì²´í¬ì•„ì›ƒ", loc: LOC.uenoHotel, desc: "ìˆ™ì†Œ(ë„¤ê¸°ì‹œ)ì—ì„œ ê¸°ìƒ ë° ì§ ì •ë¦¬" },
                    { time: "10:00 - 20:00", title: "ììœ ì‹œê°„", loc: LOC.uenoHotel, desc: "ë„ì¿„ ììœ  ì¼ì • (ì¼ì •í‘œ ì—†ìŒ)" }
                ]
            },
            {
                day: 6,
                items: [
                    { time: "00:00 - 08:00", title: "ì·¨ì¹¨ ë° ê¸°ìƒ", loc: LOC.uenoHotel, desc: "ê¸°ìƒ ë° ì¤€ë¹„" },
                    { time: "08:00 - 08:30", title: "ìš°ì—ë…¸ì—­ìœ¼ë¡œ ì´ë™", type: "move", transport: "walk", from: LOC.uenoHotel, to: LOC.uenoHotel, desc: "ìš°ì—ë…¸ì—­ ì´ë™" },
                    { time: "08:30 - 09:30", title: "ê°€ë§ˆì¿ ë¼ë¡œ ì´ë™", price: 940, type: "move", transport: "train", from: LOC.uenoHotel, to: LOC.kamakuraStn, desc: "JR ìš°ì—ë…¸ ë„ì¿„ë¼ì¸ (ì•½ 55ë¶„)" },
                    { time: "09:30 - 10:30", title: "ì“°ë£¨ê°€ì˜¤ì¹´ í•˜ì¹˜ë§Œêµ¬", loc: LOC.tsurugaoka, desc: "ì‹ ì‚¬ êµ¬ê²½ ë° ì‚°ì±…" },
                    { time: "10:30 - 11:00", title: "ê³ ë§ˆì¹˜ë„ë¦¬ ê°„ì‹", loc: LOC.komachi, pois: POIS.komachi, desc: "Giraffa (ì¹´ë ˆë¹µ), ë§ˆë©”ì•¼ ë“±" },
                    { time: "11:00 - 12:00", title: "ì ì‹¬: ì•„í‚¤ëª¨í† ", price: 2000, loc: LOC.akimoto, desc: "ì‹œë¼ìŠ¤ë™(ì”ë©¸ì¹˜ë®ë°¥) ë§›ì§‘" },
                    { time: "12:00 - 12:20", title: "í•˜ì„¸ì—­ìœ¼ë¡œ ì´ë™", price: 200, type: "move", transport: "train", from: LOC.kamakuraStn, to: LOC.haseStn, desc: "ì—ë…¸ë´ íƒ‘ìŠ¹" },
                    { time: "12:20 - 12:50", title: "ê³ í† ì¿ ì¸ (ëŒ€ë¶ˆìƒ)", loc: LOC.daibutsu, desc: "ê°€ë§ˆì¿ ë¼ ëŒ€ë¶ˆ ê´€ëŒ (ì‹œê°„ ë‹¨ì¶•)" },
                    { time: "12:50 - 13:10", title: "ê°€ë§ˆì¿ ë¼ì½”ì½”ë§ˆì— ì´ë™", price: 200, type: "move", transport: "train", from: LOC.haseStn, to: LOC.kamakurakoko, desc: "ì—ë…¸ë´ íƒ‘ìŠ¹" },
                    { time: "13:10 - 13:30", title: "ìŠ¬ë¨ë©í¬ ê±´ë„ëª©", loc: LOC.kamakurakoko, desc: "ì‚¬ì§„ ì´¬ì˜ (ì¸íŒŒ ì£¼ì˜)" },
                    { time: "13:30 - 14:00", title: "ì—ë…¸ì‹œë§ˆë¡œ ë„ë³´ ì´ë™", type: "move", transport: "walk", from: LOC.kamakurakoko, to: LOC.enoshimaIsland, desc: "í•´ë³€ ë”°ë¼ ê±·ê¸° (ì•½ 30ë¶„)" },
                    { time: "14:00 - 15:50", title: "ì—ë…¸ì‹œë§ˆ ì„¬ ê´€ê´‘", loc: LOC.enoshimaIsland, pois: POIS.enoshima, desc: "ì‹ ì‚¬, ë™êµ´, ê±°ë¦¬ êµ¬ê²½" },
                    { time: "15:50 - 16:50", title: "ì—ë…¸ì‹œë§ˆ ì”¨ìº”ë“¤", loc: LOC.seaCandle, desc: "ì „ë§ëŒ€ ë° ê²½ì¹˜ ê°ìƒ" },
                    { time: "16:50 - 17:00", title: "ì €ë… ì‹ë‹¹ ì´ë™", type: "move", transport: "walk", from: LOC.seaCandle, to: LOC.tonkatsusaito, desc: "ì¹´íƒ€ì„¸ì—ë…¸ì‹œë§ˆì—­ ì¸ê·¼ìœ¼ë¡œ ì´ë™" },
                    { time: "17:00 - 18:00", title: "ì €ë…: ëˆì¹´ì¸  (ì—ë…¸ì‹œë§ˆ)", price: 2000, loc: LOC.tonkatsusaito, desc: "Tonkatsu Saito (ì‹ì‚¬ í›„ ì´ë™)" },
                    { time: "18:00 - 19:30", title: "ì‹œë¶€ì•¼ë¡œ ì´ë™", price: 650, type: "move", transport: "train", from: LOC.kataseEnoshima, to: LOC.shibuyaStn, desc: "ì˜¤ë‹¤í/JR ì´ë™ (ì•½ 1ì‹œê°„ 30ë¶„)" },
                    { time: "19:30 - 19:40", title: "ì‹œë¶€ì•¼ ìŠ¤ì¹´ì´ ì´ë™", type: "move", transport: "walk", from: LOC.shibuyaStn, to: LOC.shibuyaSky, desc: "ìŠ¤í¬ë¨ë¸” ìŠ¤í€˜ì–´" },
                    { time: "19:40 - 21:00", title: "ì‹œë¶€ì•¼ ìŠ¤ì¹´ì´", price: 2200, loc: LOC.shibuyaSky, desc: "ì•¼ê²½ ê°ìƒ (ì‡¼í•‘íŒ€ í•©ë¥˜)" },
                    { time: "21:00 - 22:00", title: "ìˆ™ì†Œ ë³µê·€", type: "move", transport: "train", from: LOC.shibuyaStn, to: LOC.uguisudani, desc: "JR ì•¼ë§ˆë…¸í…Œì„ " }
                ],
                items_shopping: [
                    { time: "00:00 - 09:00", title: "ì·¨ì¹¨ ë° ëŠ¦ì ", loc: LOC.uenoHotel, desc: "ì—¬ìœ ë¡­ê²Œ ê¸°ìƒ" },
                    { time: "09:00 - 10:30", title: "ì¤€ë¹„ ë° ì´ë™", price: 210, type: "move", transport: "train", from: LOC.uenoHotel, to: LOC.omotesando, desc: "ì˜¤ëª¨í…Œì‚°ë„ë¡œ ì´ë™ (ê¸´ìì„ )" },
                    { time: "10:30 - 13:00", title: "ì˜¤ëª¨í…Œì‚°ë„ íì¦ˆ & ëª…í’ˆê±°ë¦¬", loc: LOC.omotesando, pois: POIS.omotesando_shop, desc: "ìì´ë ˆ(GYRE), ì• í”Œ, ë©”ì¢…í‚¤ì¸ ë„¤, ë„í”„ë¡œë Œ ë“±" },
                    { time: "13:00 - 14:00", title: "ì ì‹¬: ì˜¤ëª¨í…Œì‚°ë„ ì¹´í˜", price: 2500, loc: LOC.omotesando, desc: "ë¸ŒëŸ°ì¹˜ (Bills, ìš°ë¼ì‚°ë„ ê°€ë“  ë“±)" },
                    { time: "14:00 - 15:30", title: "ì´ë™: ìº£ìŠ¤íŠ¸ë¦¬íŠ¸ â†’ í•˜ë¼ì£¼ì¿ ", type: "move", transport: "walk", from: LOC.omotesando, to: LOC.harajuku, desc: "í¸ì§‘ìƒµ êµ¬ê²½í•˜ë©° í•˜ë¼ì£¼ì¿ ë¡œ ë„ë³´ ì´ë™" },
                    { time: "15:30 - 16:00", title: "ì´ë™: í•˜ë¼ì£¼ì¿  â†’ ì‹œë¶€ì•¼", type: "move", transport: "walk", from: LOC.harajuku, to: LOC.shibuyaSky, desc: "ìº£ìŠ¤íŠ¸ë¦¬íŠ¸ ë”°ë¼ ì‹œë¶€ì•¼ ë„ì°©" },
                    { time: "16:00 - 17:30", title: "ì‹œë¶€ì•¼/í•˜ë¼ì£¼ì¿  ì‡¼í•‘", loc: LOC.shibuyaStn, desc: "ìŠ¤í¬ë¨ë¸” êµì°¨ë¡œ, ë©”ê°€ ëˆí‚¤í˜¸í…Œ ë“±" },
                    { time: "17:30 - 19:00", title: "ì €ë…: ì‹œë¶€ì•¼ ë§›ì§‘", price: 3000, loc: LOC.shibuyaStn, desc: "ì‹œë¶€ì•¼ ì¸ê·¼ ì‹ì‚¬ (ì‹ì‚¬ í›„ í•©ë¥˜)" },
                    { time: "19:00 - 19:30", title: "ì‹œë¶€ì•¼ ìŠ¤ì¹´ì´ ì´ë™", type: "move", transport: "walk", from: LOC.shibuyaStn, to: LOC.shibuyaSky, desc: "ìŠ¤í¬ë¨ë¸” ìŠ¤í€˜ì–´" },
                    { time: "19:30 - 21:00", title: "ì¼í–‰ í•©ë¥˜: ì‹œë¶€ì•¼ ìŠ¤ì¹´ì´", price: 2200, loc: LOC.shibuyaSky, desc: "[ëª¨ë‘ í•©ë¥˜] ì•¼ê²½ ê°ìƒ ë° ë‹¨ì²´ ì‚¬ì§„" },
                    { time: "21:00 - 21:30", title: "ì´ë™: ì‹œë¶€ì•¼ì—­ â†’ ì‹ ì£¼ì¿ ì—­", price: 170, type: "move", transport: "train", from: LOC.shibuyaStn, to: LOC.shinjukuStn, desc: "ì‹ ì£¼ì¿ ë¡œ ì´ë™ (ì„ íƒ)" },
                    { time: "21:30 - 23:30", title: "ì‹¬ì•¼ ì‡¼í•‘ ë° ë’·í’€ì´", loc: LOC.kabukicho, desc: "ê°€ë¶€í‚¤ì´ˆ, ëˆí‚¤í˜¸í…Œ ë“±" },
                    { time: "23:30 - 24:00", title: "ìˆ™ì†Œ ë³µê·€", price: 210, type: "move", transport: "train", from: LOC.shinjukuStn, to: LOC.uguisudani, desc: "JR ì•¼ë§ˆë…¸í…Œì„  ë§‰ì°¨" }
                ]
            },
            // [NEW] Day 7: Otaku vs City
            {
                day: 7,
                items: [
                    { time: "00:00 - 10:30", title: "ì·¨ì¹¨ ë° ê¸°ìƒ ì¤€ë¹„", loc: LOC.uenoHotel, desc: "ëŠê¸‹í•˜ê²Œ ì¼ì–´ë‚˜ì„œ ì•„ì¹¨ ê²¸ ì ì‹¬ ì‹ì‚¬" },
                    { time: "10:30 - 11:15", title: "ì´ë™: ìš°êµ¬ì´ìˆ˜ë‹¤ë‹ˆ â†’ ë‚˜ì¹´ë…¸ì—­", price: 230, type: "move", transport: "train", from: LOC.uguisudani, to: LOC.nakanoStn, desc: "ì‹ ì£¼ì¿  í™˜ìŠ¹ ì£¼ì˜¤ì„ (ì¾Œì†), ì•½ 45ë¶„" },
                    { time: "11:15 - 12:00", title: "ì´ë¥¸ ì ì‹¬: ë‚˜ì¹´ë…¸ ë¸Œë¡œë“œì›¨ì´", loc: LOC.nakanoBroadway, desc: "'ë°ì¼ë¦¬ ì¹˜ì½”'(8ë‹¨ ì•„ì´ìŠ¤í¬ë¦¼) or ì§€í•˜ ì‹ë‹¹ê°€" },
                    { time: "12:00 - 14:30", title: "íƒêµ´: ë‚˜ì¹´ë…¸ ë¸Œë¡œë“œì›¨ì´", loc: LOC.nakanoBroadway, pois: POIS.nakano_detailed, desc: "ë§Œë‹¤ë¼ì¼€ Galaxy, Deep ì§‘ì¤‘ ê³µëµ" },
                    { time: "14:30 - 15:00", title: "ì´ë™: ë‚˜ì¹´ë…¸ì—­ â†’ ì•„í‚¤í•˜ë°”ë¼ì—­", price: 230, type: "move", transport: "train", from: LOC.nakanoStn, to: LOC.radioKaikan, desc: "ì£¼ì˜¤-ì†Œë¶€ì„ (ë…¸ë€ìƒ‰) í™˜ìŠ¹ ì—†ìŒ, ì•½ 30ë¶„" },
                    { time: "15:00 - 15:15", title: "ì½”ì¸ ë¡œì»¤ ì§ ë³´ê´€", loc: LOC.akibaLocker, desc: "ì „ë¦¬í’ˆ ë³´ê´€ (ì•„í‚¤í•˜ë°”ë¼ì—­/ë¼ë””ì˜¤íšŒê´€)" },
                    { time: "15:15 - 17:00", title: "ì‡¼í•‘ 1ì°¨ì „: ë¼ë””ì˜¤íšŒê´€", loc: LOC.radioKaikan, pois: POIS.akiba_deep_shopping, desc: "ì•„ë¯¸ì•„ë¯¸, K-Books, ë Œíƒˆ ì‡¼ì¼€ì´ìŠ¤ ê³µëµ" },
                    { time: "17:00 - 18:30", title: "ì‡¼í•‘ 2ì°¨ì „: ì‹¬ì—°ì˜ ë³¸ì§„", loc: LOC.traderHQ, desc: "íŠ¸ë ˆì´ë” ë³¸ì (PC/ë¯¸ì†Œë…€), ë©œë¡ ë¶ìŠ¤" },
                    { time: "18:30 - 19:30", title: "ì €ë…: ì•„í‚¤ë°” ìŠ¤íƒ€ì¼", loc: LOC.gogoCurry, desc: "ê³ ê³  ì¹´ë ˆ or ê·œë™ ì‚°ë³´ ë“± ë“ ë“ í•˜ê²Œ í•´ê²°" },
                    { time: "19:30 - 20:30", title: "ì‡¼í•‘ 3ì°¨ì „: ìŠ¤ë£¨ê°€ì•¼ & ë¼ì‹ ë°˜", loc: LOC.surugayaDeep, desc: "ì‹ì‚¬ í›„ ì†Œí™”ì‹œí‚¬ ê²¸ ë¤í•‘ êµ¿ì¦ˆ ë””ê¹…" },
                    { time: "20:30 - 21:00", title: "ì´ë™: ì•„í‚¤í•˜ë°”ë¼ â†’ ìˆ™ì†Œ", price: 150, type: "move", transport: "train", from: LOC.radioKaikan, to: LOC.uguisudani, desc: "ì§ ì°¾ì•„ì„œ ë³µê·€ (ì•½ 30ë¶„)" },
                    { time: "21:00 - 24:00", title: "ìˆ™ì†Œ ë„ì°© ë° ì–¸ë°•ì‹±", loc: LOC.uenoHotel, desc: "í¸ì˜ì  ê°„ì‹ê³¼ í•¨ê»˜ ì „ë¦¬í’ˆ ê°ìƒíšŒ" }
                ],
                // ë„ì¿„ ì‹œë‚´ íŒŸ (5ëª…)
                items_shopping: [
                    { time: "09:00 - 10:00", title: "ê¸°ìƒ ë° ì¤€ë¹„", loc: LOC.uenoHotel, desc: "ì‹œë‚´ íˆ¬ì–´ ì¤€ë¹„" },
                    { time: "10:00 - 22:00", title: "ë„ì¿„ ì‹œë‚´ ììœ  ì—¬í–‰", loc: LOC.tokyoStn, desc: "ë„ì¿„ì—­, ê¸´ì, ë¡¯í°ê¸° ë“± ììœ  ì¼ì • (ìƒì„¸ ì—†ìŒ)" },
                    { time: "22:00 - 24:00", title: "ìˆ™ì†Œ ë³µê·€ ë° íœ´ì‹", loc: LOC.uenoHotel, desc: "ì˜¤íƒ€ì¿  íŒŸê³¼ í•©ë¥˜" }
                ]
            },
            {
                day: 8,
                items: [
                    { time: "00:00 - 08:30", title: "ê¸°ìƒ ë° ì²´í¬ì•„ì›ƒ", loc: LOC.uenoHotel, desc: "ì§ ì±™ê²¨ì„œ ì¶œë°œ" },
                    { time: "08:30 - 09:00", title: "ìš°ì—ë…¸ì—­ìœ¼ë¡œ ì´ë™", type: "move", transport: "walk", from: LOC.uenoHotel, to: LOC.uenoHotel, desc: "ìš°ì—ë…¸ì—­ ì´ë™" },
                    { time: "09:00 - 09:30", title: "ë„ì¿„ì—­ìœ¼ë¡œ ì´ë™", price: 170, type: "move", transport: "train", from: LOC.uenoHotel, to: LOC.tokyoStn, desc: "JR ì•¼ë§ˆë…¸í…Œì„ /ê²Œì´íŒí† í˜¸ì¿ ì„ " },
                    { time: "09:30 - 09:45", title: "ì½”ì¸ë¡œì»¤ ì§ ë³´ê´€", loc: LOC.tokyoStn, desc: "ë„ì¿„ì—­ ë‚´ ë³´ê´€í•¨" },
                    { time: "09:45 - 11:30", title: "ë„ì¿„ì—­ êµ¬ê²½", loc: LOC.tokyoStn, pois: POIS.tokyo_char, desc: "ìºë¦­í„° ìŠ¤íŠ¸ë¦¬íŠ¸, ë¼ë©˜ ìŠ¤íŠ¸ë¦¬íŠ¸ ë“±" },
                    { time: "11:30 - 11:45", title: "ê¸´ìë¡œ ì´ë™", type: "move", transport: "walk", from: LOC.tokyoStn, to: LOC.ginza, desc: "ë„ë³´ ì´ë™ (ì•½ 15ë¶„)" },
                    { time: "11:45 - 13:00", title: "ì ì‹¬: ê¸´ì ë°”ì´ë¦° (ëˆì¹´ì¸ )", price: 3000, loc: LOC.ginzaBairin, desc: "ê¸´ì 3ëŒ€ ëˆì¹´ì¸  ë§›ì§‘" },
                    { time: "13:00 - 14:30", title: "ê¸´ì ì‡¼í•‘", loc: LOC.ginza, pois: POIS.ginza_shop, desc: "ìœ ë‹ˆí´ë¡œ 12ì¸µ, ì´í† ì•¼, ë¯¸ì¸ ì½”ì‹œ ë“±" },
                    { time: "14:30 - 14:45", title: "ë„ì¿„ì—­ìœ¼ë¡œ ë³µê·€", type: "move", transport: "walk", from: LOC.ginza, to: LOC.tokyoStn, desc: "ë„ë³´ ì´ë™" },
                    { time: "14:45 - 15:00", title: "ì§ ì°¾ê¸° ë° ìŠ¹ê°•ì¥ ì´ë™", loc: LOC.tokyoStn, desc: "ë‚˜ë¦¬íƒ€ ìµìŠ¤í”„ë ˆìŠ¤ ìŠ¹ê°•ì¥ í™•ì¸" },
                    { time: "15:00 - 16:00", title: "ê³µí•­ìœ¼ë¡œ ì´ë™ (N'EX)", price: 3070, type: "move", transport: "train", from: LOC.tokyoStn, to: LOC.narita, desc: "ë‚˜ë¦¬íƒ€ ìµìŠ¤í”„ë ˆìŠ¤ íƒ‘ìŠ¹" },
                    { time: "16:00 - 19:00", title: "ì¶œêµ­ ìˆ˜ì† ë° ë©´ì„¸ì ", loc: LOC.narita, desc: "í‹°ì¼“ ë°œê¶Œ, ì§ ë¶€ì¹˜ê¸°, ì‹ì‚¬ ë“±" },
                    { time: "19:00 - 21:30", title: "ì¸ì²œê³µí•­ìœ¼ë¡œ ë¹„í–‰", loc: LOC.narita, desc: "í•œêµ­ìœ¼ë¡œ ê·€êµ­" }
                ]
            }
        ];

        // --- 2. LOGIC ---
        function getDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        }

        const SCHEDULE = RAW_DATA;

        let selectedIndices = new Set();
        let longPressTimer;
        let isLongPressTriggered = false;
        let currentDay = 0;
        let currentTeam = 'attraction'; // 'attraction' | 'shopping'

        // --- 3. MAP ---
        const map = L.map('map', { zoomControl: false }).setView([34.6618, 135.5021], 13);
        L.control.zoom({ position: 'topright' }).addTo(map);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; CARTO', maxZoom: 19
        }).addTo(map);

        let layers = [];
        const icons = {
            start: L.divIcon({ html: '<div class="bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold shadow-lg border-2 border-white">S</div>', className: 'bg-transparent', iconSize: [32, 32], iconAnchor: [16, 32] }),
            end: L.divIcon({ html: '<div class="bg-slate-700 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold shadow-lg border-2 border-white">E</div>', className: 'bg-transparent', iconSize: [32, 32], iconAnchor: [16, 32] }),
            poi: L.divIcon({ className: 'pulse-icon' }),
            poiBlue: L.divIcon({ className: 'pulse-icon-blue' }),
            splitA: L.divIcon({ html: '<div class="bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold border-2 border-white">A</div>', className: 'bg-transparent', iconSize: [24, 24] }),
            splitB: L.divIcon({ html: '<div class="bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold border-2 border-white">B</div>', className: 'bg-transparent', iconSize: [24, 24] }),
            splitShop: L.divIcon({ html: '<div class="bg-purple-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold border-2 border-white"><i class="fas fa-shopping-bag"></i></div>', className: 'bg-transparent', iconSize: [24, 24] })
        };

        function getNumberIcon(num) {
            return L.divIcon({
                html: `<div class="number-icon">${num}</div>`,
                className: 'bg-transparent',
                iconSize: [24, 24],
                iconAnchor: [12, 12]
            });
        }

        async function drawRoute(from, to, color = '#3b82f6', dashed = false) {
            const options = { color: color, weight: 5, opacity: 0.8, lineJoin: 'round' };
            if (dashed) options.dashArray = '1, 10';
            const line = L.polyline([from, to], dashed ? { ...options, dashArray: '8, 8', weight: 4, color: '#cbd5e1' } : options).addTo(map);
            if (dashed) { layers.push(line); return; }
            layers.push(line);
            try {
                const dist = getDistance(from[0], from[1], to[0], to[1]);
                if (dist > 100) { map.fitBounds(line.getBounds(), { padding: [50, 50] }); return; }
                const resp = await fetch(`https://router.project-osrm.org/route/v1/foot/${from[1]},${from[0]};${to[1]},${to[0]}?overview=full&geometries=geojson`);
                const data = await resp.json();
                if (data.code === 'Ok') {
                    const coords = data.routes[0].geometry.coordinates.map(c => [c[1], c[0]]);
                    map.removeLayer(line);
                    const route = L.polyline(coords, options).addTo(map);
                    layers.push(route);
                    map.fitBounds(route.getBounds(), { padding: [50, 50] });
                }
            } catch (e) { }
        }

        // --- 4. SELECTION & MAP UPDATE ---
        function clearSelection() {
            selectedIndices.clear();
            document.querySelectorAll('.schedule-item').forEach(e => e.classList.remove('multi-selected'));
            document.getElementById('btn-reset-select').classList.add('hidden');
            document.getElementById('map-info').classList.add('hidden');
            layers.forEach(l => map.removeLayer(l)); layers = [];

            let dayData = SCHEDULE[currentDay];
            let items = ((currentDay === 0 || currentDay === 5 || currentDay === 6) && currentTeam === 'shopping') ? dayData.items_shopping : dayData.items;
            const first = items.find(i => i.loc || i.from);
            if (first) map.setView(first.loc || first.from, 13);
        }

        function updateMultiSelectMap() {
            layers.forEach(l => map.removeLayer(l)); layers = [];
            document.getElementById('map-info').classList.add('hidden');

            let dayData = SCHEDULE[currentDay];
            let items = ((currentDay === 0 || currentDay === 5 || currentDay === 6) && currentTeam === 'shopping') ? dayData.items_shopping : dayData.items;
            const indices = Array.from(selectedIndices).sort((a, b) => a - b);

            if (indices.length === 0) return;

            const routePoints = [];
            indices.forEach((idx, i) => {
                const item = items[idx];
                const pos = item.loc || item.to || item.from;
                if (pos) {
                    routePoints.push(pos);
                    layers.push(L.marker(pos, { icon: getNumberIcon(i + 1) }).addTo(map));
                }
            });

            if (routePoints.length > 1) {
                const pathLine = L.polyline(routePoints, { color: '#3b82f6', weight: 4, dashArray: '10, 10', opacity: 0.8 }).addTo(map);
                layers.push(pathLine);
                map.fitBounds(pathLine.getBounds(), { padding: [50, 50] });
            } else if (routePoints.length === 1) {
                map.setView(routePoints[0], 15);
            }
        }

        function handleItemClick(index, card) {
            let dayData = SCHEDULE[currentDay];
            let items = ((currentDay === 0 || currentDay === 5 || currentDay === 6) && currentTeam === 'shopping') ? dayData.items_shopping : dayData.items;
            const item = items[index];

            if (selectedIndices.size > 0 || isLongPressTriggered) {
                if (selectedIndices.has(index)) {
                    selectedIndices.delete(index);
                    card.classList.remove('multi-selected');
                } else {
                    selectedIndices.add(index);
                    card.classList.add('multi-selected');
                }
                if (selectedIndices.size === 0) {
                    clearSelection();
                } else {
                    document.getElementById('btn-reset-select').classList.remove('hidden');
                    updateMultiSelectMap();
                }
                return;
            }

            document.querySelectorAll('.schedule-item').forEach(e => e.classList.remove('active-card', 'multi-selected'));
            card.classList.add('active-card');

            layers.forEach(l => map.removeLayer(l)); layers = [];

            const infoBox = document.getElementById('map-info');
            const infoContent = document.getElementById('info-content');
            const toggleIcon = document.getElementById('toggle-icon');

            infoBox.classList.remove('hidden', 'opacity-0', 'translate-y-[-20px]');
            infoContent.classList.add('collapsed-content');
            toggleIcon.classList.add('rotate-180');

            document.getElementById('info-title').innerText = item.title;

            let infoHtml = `<p class="mb-2">${item.desc || ''}</p>`;
            if (item.time) infoHtml += `<p class="text-xs text-gray-400 mb-2"><i class="far fa-clock"></i> ${item.time}</p>`;

            const isMove = item.type === 'move';
            const isSplit = item.type === 'split_dinner';

            if (isSplit) {
                const start = item.day === 6 ? LOC.uenoHotel : LOC.akihabara;
                item.routes.forEach(r => {
                    if (!r.name.includes('ì‡¼í•‘')) {
                        drawRoute(start, r.to, r.color);
                    }
                    let iconType = icons.splitA;
                    if (r.name.includes('B') || r.name.includes('í˜¸íƒ€í…Œ')) iconType = icons.splitB;
                    if (r.name.includes('ì‡¼í•‘')) iconType = icons.splitShop;
                    layers.push(L.marker(r.to, { icon: iconType }).addTo(map).bindPopup(r.name));
                });
                layers.push(L.marker(start, { icon: icons.start }).addTo(map));
            } else if (item.type === 'merge') {
                item.froms.forEach((f, idx) => {
                    drawRoute(f, item.loc, idx === 0 ? '#ef4444' : '#22c55e');
                    layers.push(L.marker(f, { icon: idx === 0 ? icons.splitA : icons.splitB }).addTo(map));
                });
                layers.push(L.marker(item.loc, { icon: icons.end }).addTo(map).bindPopup("GIGO ì§‘ê²°"));
            } else if (isMove) {
                drawRoute(item.from, item.to, item.transport === 'train' ? '#8b5cf6' : '#3b82f6');
                layers.push(L.marker(item.from, { icon: icons.start }).addTo(map));
                layers.push(L.marker(item.to, { icon: icons.end }).addTo(map));
            } else {
                if (item.loc) {
                    map.setView(item.loc, 15);
                    layers.push(L.marker(item.loc, { icon: icons.start }).addTo(map));
                }
                if (item.pois) {
                    const bounds = L.latLngBounds(item.pois.map(p => p.pos));
                    item.pois.forEach(p => {
                        layers.push(L.marker(p.pos, { icon: icons.poi }).addTo(map).bindTooltip(p.name, { permanent: true, direction: 'top', className: 'text-xs font-bold bg-white border px-1 rounded shadow' }));
                    });
                    map.fitBounds(bounds, { padding: [50, 50] });
                    infoHtml += `<div class="grid grid-cols-2 gap-1 mt-2">`;
                    item.pois.forEach(p => infoHtml += `<span class="text-xs bg-gray-50 px-2 py-1 rounded border">ğŸ“ ${p.name}</span>`);
                    infoHtml += `</div>`;
                }
            }
            document.getElementById('info-content').innerHTML = infoHtml;
        }

        // --- 5. RENDER ---
        function formatMoney(n) { return n ? `Â¥${n.toLocaleString()}` : ''; }

        function toggleInfo() {
            const content = document.getElementById('info-content');
            const icon = document.getElementById('toggle-icon');
            if (content.classList.contains('collapsed-content')) {
                content.classList.remove('collapsed-content');
                icon.classList.remove('rotate-180');
            } else {
                content.classList.add('collapsed-content');
                icon.classList.add('rotate-180');
            }
        }

        function closeInfo() {
            document.getElementById('map-info').classList.add('hidden', 'opacity-0', 'translate-y-[-20px]');
        }

        function selectTeam(team) {
            currentTeam = team;

            const btnAtt = document.getElementById('btn-team-attraction');
            const btnShop = document.getElementById('btn-team-shopping');

            if (team === 'attraction') {
                btnAtt.className = 'team-toggle team-active px-4 py-1.5 rounded-full text-xs font-bold border shadow-sm';
                btnShop.className = 'team-toggle team-inactive px-4 py-1.5 rounded-full text-xs font-bold border shadow-sm';
            } else {
                btnAtt.className = 'team-toggle team-inactive px-4 py-1.5 rounded-full text-xs font-bold border shadow-sm';
                btnShop.className = 'team-toggle team-active px-4 py-1.5 rounded-full text-xs font-bold border shadow-sm';
            }

            renderTimeline(currentDay);

            const dayData = SCHEDULE[currentDay];
            const items = (team === 'shopping') ? dayData.items_shopping : dayData.items;
            const first = items.find(i => i.loc || i.from);
            if (first) map.setView(first.loc || first.from, 13);
        }

        function renderTimeline(dayIdx) {
            currentDay = dayIdx;
            clearSelection();

            const list = document.getElementById('schedule-list');
            const dayData = SCHEDULE[dayIdx];
            const legend = document.getElementById('split-legend');
            const teamSelector = document.getElementById('team-selector');
            const btnAtt = document.getElementById('btn-team-attraction');
            const btnShop = document.getElementById('btn-team-shopping');

            list.innerHTML = '';

            if (dayIdx === 0) { // 1ì¼ì°¨
                teamSelector.classList.remove('hidden');
                btnAtt.innerHTML = "ğŸƒ ì„ ë°œëŒ€ (Advance)";
                btnShop.innerHTML = "ğŸ¢ í›„ë°œëŒ€ (Rear)";
            } else if (dayIdx === 5) { // 6ì¼ì°¨
                teamSelector.classList.remove('hidden');
                btnAtt.innerHTML = "ğŸšƒ ê·¼êµ íŒŸ (5ëª…)";
                btnShop.innerHTML = "ğŸ›ï¸ ì‡¼í•‘ íŒŸ (3ëª…)";
            } else if (dayIdx === 6) { // 7ì¼ì°¨
                teamSelector.classList.remove('hidden');
                btnAtt.innerHTML = "ğŸ¤“ ì˜¤íƒ€ì¿  íŒŸ (3ëª…)";
                btnShop.innerHTML = "ğŸ™ï¸ ë„ì¿„ ì‹œë‚´ íŒŸ (5ëª…)";
            } else {
                teamSelector.classList.add('hidden');
            }

            if (dayIdx === 6) {
                legend.classList.remove('hidden');
                legend.innerHTML = `
                    <div class="flex items-center gap-1"><span class="w-3 h-3 bg-red-500 rounded-full"></span> <span>ğŸšƒ ì˜¤íƒ€ì¿  (3ëª…)</span></div>
                    <div class="flex items-center gap-1"><span class="w-3 h-3 bg-purple-500 rounded-full"></span> <span>ğŸ›ï¸ ë„ì¿„ ì‹œë‚´ (5ëª…)</span></div>
                `;
            } else if (dayIdx === 5 && currentTeam === 'attraction') {
                legend.classList.remove('hidden');
                legend.innerHTML = `
                    <div class="flex items-center gap-1"><span class="w-3 h-3 bg-red-500 rounded-full"></span> <span>ğŸšƒ ê·¼êµ (5ëª…)</span></div>
                    <div class="flex items-center gap-1"><span class="w-3 h-3 bg-purple-500 rounded-full"></span> <span>ğŸ›ï¸ ì‡¼í•‘ (3ëª…)</span></div>
                `;
            } else {
                legend.classList.add('hidden');
            }

            let items = dayData.items;
            if ((dayIdx === 0 || dayIdx === 5 || dayIdx === 6) && currentTeam === 'shopping') {
                items = dayData.items_shopping;
            }

            let total = 0; items.forEach(i => total += (i.price || 0));
            document.getElementById('total-cost-desktop').innerText = `ì´ ì˜ˆìƒ ë¹„ìš©: ${formatMoney(total)}`;
            document.getElementById('total-cost-mobile').innerText = `Total: ${formatMoney(total)}`;

            setTimeout(() => { document.getElementById('multi-select-hint').classList.add('opacity-0'); }, 3000);

            items.forEach((item, index) => {
                const isMove = item.type === 'move';
                const isSplit = item.type === 'split_dinner';

                const card = document.createElement('div');
                card.className = `schedule-item p-3 md:p-4 rounded-xl shadow-sm border border-gray-100 cursor-pointer relative bg-white my-2 select-none ${isMove ? 'bg-slate-50 border-dashed opacity-80' : ''}`;

                let iconEl = `<div class="w-10 h-10 rounded-full bg-indigo-50 text-indigo-500 flex items-center justify-center"><i class="fas fa-map-pin"></i></div>`;
                if (item.title.includes('ê¸°ìƒ') || item.title.includes('ì·¨ì¹¨')) iconEl = `<div class="w-10 h-10 rounded-full bg-yellow-50 text-yellow-500 flex items-center justify-center"><i class="fas fa-bed"></i></div>`;
                else if (isMove) iconEl = `<div class="w-8 h-8 rounded-full bg-slate-100 text-slate-400 flex items-center justify-center"><i class="fas fa-${item.transport === 'train' ? 'train' : 'person-walking'}"></i></div>`;
                else if (item.title.includes('ì‹ì‚¬') || item.title.includes('ì €ë…') || item.title.includes('ì ì‹¬')) iconEl = `<div class="w-10 h-10 rounded-full bg-orange-50 text-orange-500 flex items-center justify-center"><i class="fas fa-utensils"></i></div>`;
                else if (isSplit) iconEl = `<div class="w-10 h-10 rounded-full bg-pink-50 text-pink-500 flex items-center justify-center"><i class="fas fa-code-branch"></i></div>`;

                let timeStr = item.time ? item.time.replace(' - ', '<br>~<br>') : '';

                let content = `<div class="flex items-center gap-3">`;
                content += `<div class="flex flex-col items-center gap-1 min-w-[50px] leading-tight text-center"><span class="text-[10px] font-bold text-gray-500">${timeStr}</span>${iconEl}</div>`;
                content += `<div class="flex-1 min-w-0"><div class="flex justify-between items-start"><h4 class="font-bold text-gray-800 truncate ${isMove ? 'text-sm text-gray-500' : ''}">${item.title}</h4>`;
                if (item.price) content += `<span class="text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold ml-1 shrink-0">${formatMoney(item.price)}</span>`;
                content += `</div>`;

                if (item.desc) content += `<p class="text-xs text-gray-500 mt-1 truncate">${item.desc}</p>`;
                if (isMove && item.dist) content += `<p class="text-[10px] text-blue-500 font-semibold mt-0.5"><i class="fas fa-route"></i> ${item.dist}km ì´ë™</p>`;

                if (isSplit) {
                    if (currentDay === 5) {
                        content += `<div class="flex gap-2 mt-2"><span class="text-[10px] px-2 py-1 rounded border split-badge-a flex-1 text-center">ğŸšƒ ê·¼êµ (5ëª…)</span><span class="text-[10px] px-2 py-1 rounded border split-badge-shop flex-1 text-center">ğŸ›ï¸ ì‡¼í•‘ (3ëª…)</span></div>`;
                    } else {
                        content += `<div class="flex gap-2 mt-2"><span class="text-[10px] px-2 py-1 rounded border split-badge-a flex-1 text-center">A: í˜¼ë‹¤</span><span class="text-[10px] px-2 py-1 rounded border split-badge-b flex-1 text-center">B: í˜¸íƒ€í…Œ</span></div>`;
                    }
                }
                content += `</div></div>`;
                card.innerHTML = content;

                const startEvent = (e) => {
                    isLongPressTriggered = false;
                    longPressTimer = setTimeout(() => {
                        isLongPressTriggered = true;
                        if (navigator.vibrate) navigator.vibrate(50);
                        handleItemClick(index, card);
                    }, 500);
                };
                const clearEvent = () => { clearTimeout(longPressTimer); };

                card.addEventListener('mousedown', startEvent);
                card.addEventListener('mouseup', clearEvent);
                card.addEventListener('mouseleave', clearEvent);
                card.addEventListener('touchstart', startEvent, { passive: true });
                card.addEventListener('touchend', clearEvent);
                card.addEventListener('touchmove', clearEvent);
                card.onclick = (e) => {
                    if (!isLongPressTriggered) {
                        handleItemClick(index, card);
                    }
                    isLongPressTriggered = false;
                };

                list.appendChild(card);
            });
        }

        function selectDay(idx) {
            currentDay = idx;

            [0, 1, 2, 3, 4, 5, 6, 7].forEach(i => {
                const btn = document.getElementById(`tab-${i}`);
                if (!btn) return;

                if (i === idx) { btn.classList.add('text-indigo-600', 'border-indigo-600'); btn.classList.remove('text-gray-500'); }
                else { btn.classList.remove('text-indigo-600', 'border-indigo-600'); btn.classList.add('text-gray-500'); }
            });

            // ë‚ ì§œ ë³€ê²½ ì‹œ ê¸°ë³¸ íŒ€ì€ ì–´íŠ¸ë™ì…˜(ì²«ë²ˆì§¸)ìœ¼ë¡œ ì´ˆê¸°í™”
            if (idx === 0 || idx === 5 || idx === 6) selectTeam('attraction');
            else renderTimeline(idx);

            const dayData = SCHEDULE[idx];
            const items = ((idx === 0 || idx === 5 || idx === 6) && currentTeam === 'shopping') ? dayData.items_shopping : dayData.items;
            const first = items.find(i => i.loc || i.from);
            if (first) map.setView(first.loc || first.from, 13);
        }

        function initResizer() {
            const resizer = document.getElementById('resizer');
            const sidebar = document.getElementById('sidebar-panel');
            const mapContainer = document.getElementById('map-container');

            let isResizing = false;

            resizer.addEventListener('mousedown', (e) => { isResizing = true; e.preventDefault(); });
            resizer.addEventListener('touchstart', (e) => { isResizing = true; e.preventDefault(); });

            window.addEventListener('mousemove', (e) => {
                if (!isResizing) return;

                if (window.innerWidth >= 768) {
                    const percentage = (e.clientX / window.innerWidth) * 100;
                    if (percentage > 20 && percentage < 80) {
                        sidebar.style.width = `${percentage}%`;
                    }
                }
                else {
                    const percentage = (e.clientY / window.innerHeight) * 100;
                    if (percentage > 20 && percentage < 80) {
                        sidebar.style.height = `${percentage}%`;
                    }
                }
                map.invalidateSize();
            });

            window.addEventListener('touchmove', (e) => {
                if (!isResizing) return;
                const touch = e.touches[0];

                if (window.innerWidth >= 768) {
                    const percentage = (touch.clientX / window.innerWidth) * 100;
                    if (percentage > 20 && percentage < 80) {
                        sidebar.style.width = `${percentage}%`;
                    }
                } else {
                    const percentage = (touch.clientY / window.innerHeight) * 100;
                    if (percentage > 20 && percentage < 80) {
                        sidebar.style.height = `${percentage}%`;
                    }
                }
                map.invalidateSize();
            });

            window.addEventListener('mouseup', () => { isResizing = false; map.invalidateSize(); });
            window.addEventListener('touchend', () => { isResizing = false; map.invalidateSize(); });
        }

        initResizer();
        selectDay(0);
    </script>
</body>

</html>
